%!TEX root = ../dissertation.tex
%\begin{savequote}[75mm]
%Nulla facilisi. In vel sem. Morbi id urna in diam dignissim feugiat. Proin molestie tortor eu velit. Aliquam erat volutpat. Nullam ultrices, diam tempus vulputate egestas, eros pede varius leo.
%\qauthor{Quoteauthor Lastname}
%\end{savequote}

\chapter{Amortization in a variational framework}
\label{chap:LTI}

Bayesian theories of cognition assume that people can integrate probabilities rationally. However, several empirical findings contradict this proposition: human probabilistic inferences are prone to systematic deviations from optimality. In Chapter \ref{chap:MCMC}, I model some of these biases with sampling-based approximation architectures under ecological constraints. However, these models cannot account for a crucial characteristic of some of these deviations: depending on the domain, they sometimes go in opposite directions. Whereas some studies suggest that people under-react to prior probabilities (\emph{base rate neglect}), other studies find that people under-react to the likelihood of the data (\emph{conservatism}). While these have separately been modeled as different heuristics, it remains unclear why one heuristic appears in certain domains, while a different one applies in other domains.

I argue that these deviations arise because the human brain does not rely solely on a general-purpose mechanism for approximating Bayesian inference that is invariant across queries. Instead, the brain is equipped with a recognition model that maps queries to probability distributions, that flexibly amortizes previous computations. The parameters of this recognition model are optimized to get the output as close as possible, on average, to the true posterior. Because of our limited computational resources, the recognition model will allocate its resources so as to be more accurate for high probability queries than for low probability queries. This results in heuristic inference strategies, that adapt to the environment. By adapting to the query distribution, the recognition model exhibits ecological rationality.

I show that this theory can explain why and when people under-react to the data or the prior, and a new experiment demonstrates that these two forms of under-reaction can be systematically controlled by manipulating the query distribution. The theory also explains a range of related phenomena: memory effects, belief bias, and the structure of response variability in probabilistic reasoning. It can also explain a quandary from the previous chapter of how to flexibly re-use inferences across different probability distributions. I also discuss how the theory can be integrated with sampling-based accounts of approximate inference.

\section{Context-sensitivity of inferential errors}

Studies of probabilistic reasoning frequently portray people as prone to errors \citep{tversky1974judgment,slovic1971comparison,grether1980bayes,fischhoff1983hypothesis}. The cognitive processes that produce these errors is the subject of considerable debate \citep{mellers2001frequency,gigerenzer1996narrow,samuels2012ending}. One influential class of models holds that rational probabilistic reasoning is too cognitively burdensome for people, who instead use a variety of heuristics \citep{tversky1974judgment,gigerenzer1996reasoning,shah2008heuristics}. Alternatively, rational process models hold that errors arise from principled approximations of rational reasoning, for example some form of hypothesis sampling \citep{dasgupta2017hypotheses,sanborn2016bayesian,griffiths2012bridging}. These different perspectives have some common ground; certain heuristics might be considered accurate approximations \citep{gigerenzer2009homo,parpart2018heuristics,belousov2016catching}.

One challenge facing both heuristic and rational process models is that people appear to make different errors in different contexts. For example, some studies report \emph{base rate neglect} \citep{bar1980base,birnbaum1983base,grether1980bayes,kahneman1973psychology}, the finding that people under-react to prior probabilities relative to Bayes' rule. Other studies report \emph{conservatism} \citep{phillips1966conservatism, peterson1965sensitivity}, the finding that people under-react to evidence.\footnote{We will mostly avoid the term ``conservatism'' to denote under-reaction to data, because it is sometimes conflated with a bias to give ``conservative'' probability judgments (i.e., judgments close to uniform probability). These distinct phenomena make the same predictions only when the prior is uniform over hypotheses. We return to the second use of the term later in the article.}

Heuristic models respond to this challenge by allowing heuristics to be context-sensitive, an example of \emph{strategy selection} \citep{gigerenzer2008heuristics,marewski2014strategy}. Most models of strategy selection assume that people are able to assess the usefulness of a strategy, through cost-benefit analysis \citep{johnson85,beach1978contingency,lieder2017strategy}, reinforcement learning \citep{erev05,rieskamp06}, or based on the strategy's applicability in a particular domain \citep{marewski2011cognitive,schulz2016simple}. All of these approaches require, either explicitly or implicitly, a feedback signal. This requirement poses a problem in inferential settings where no feedback is available. People can readily answer questions like ``How likely is it that a newly invented machine could transform a rose into a blackbird?'' \citep{Griffiths15} which lack an objective answer even in principle.  

Most rational process models are based on domain-general algorithms, and thus struggle to explain the context-sensitivity of inferential errors \citep[see][for a similar argument]{mercier2017enigma}. Some models explain why certain kinds of queries induce certain kinds of errors \citep{dasgupta2017hypotheses}, but do not explain how errors can be modulated by other queries in the same context \citep{gershman2014amortized,dasgupta2018remembrance}.

In this paper, we develop a new class of rational process models that explain the context-sensitivity of inferential errors. Specifically, we propose that people \emph{learn to infer}. Instead of a domain-general inference algorithm that treats all queries equally, we postulate an approximate \emph{recognition model} \citep{dayan1995helmholtz,kingma2014auto} that maps queries to posterior probabilities.\footnote{When the recognition model is parametrized as a neural network, it is sometimes also referred to as an \emph{inference network} \citep{mnih2014neural,rezende2015variational,paige2016inference}.} The parameters of this recognition model are optimized based on the distribution of queries, such that the output is on average as close as possible to the true posterior. This leads to learned biases in which sources of information to ignore, depending on which of these sources reliably co-vary with the true posterior.\footnote{We focus on domains where we can control this covariance (of information sources with the posterior) within an experiment, to study the development of context-sensitive inferential errors. We also discuss how similar mechanisms could explain errors in more 'real-world' domains where this context is learned from experience before the experiment, based on ecological distributions of the relevant probabilities.} Importantly, this optimization is carried out without explicit feedback about the true posterior \citep{mnih2014neural}.

Like other rational process models, our approach is motivated by the fact that any computationally realistic agent that performs inference in complex probabilistic models---in the real world, in real time---will need to make approximate inferences. Exact Bayesian inference is almost always impossible. ``Learning to infer'' refers to a particular approximate inference scheme, using a pattern recognition system (such as a neural network, but it could also be an exemplar generalization model) to find and exploit patterns in the conditional distribution of hypotheses given data (the posterior). We will argue that a relatively simple model of learned inference is both a good approximate inference scheme, purely on algorithmic terms, and also can account for a number of patterns of heuristic inference in the behavioral literature, where people have been observed to deviate from ideal Bayesian updating in ways that are otherwise hard to reconcile and even appear contradictory, because they appear to deviate from Bayesian norms in different ways and in different contexts. Our theory of learning to infer explains why these contextual variations are observed, and why they \emph{should} be observed, in a system designed to adapt efficient approximate inference to the environments it finds itself in. 

The rest of the paper is organized as follows. We first summarize the empirical and theoretical literature on our motivating puzzle (under-reaction to prior vs. likelihood). We then introduce our new theory. In addition to addressing under-reaction, we show that the theory can explain a number of related phenomena: memory effects, belief bias, and the structure of response variability in probabilistic reasoning. In the Discussion, we connect our theory to previous accounts of approximate inference in human probabilistic reasoning.

\section{Under-reaction to probabilistic information}

Given data $d$, Bayes' rule stipulates how a rational agent should update its prior probabilistic beliefs $P(h)$ about hypothesis $h$:
\begin{align}
    P(h|d) = \frac{P(d|h)P(h)}{\sum_{h'} P(d|h') P(h')},
\end{align}
where $P(h|d)$ is the agent's posterior distribution, expressing its updated beliefs, and $P(d|h)$ is the likelihood, expressing the probability of the observed data under candidate hypothesis $h$.

The earliest studies of probabilistic belief updating, carried out by Ward Edwards and his students \citep{phillips1966conservatism,edwards1968conservatism}, asked subjects to imagine a set of 100 bags filled with blue and red poker chips. ``Red'' bags were filled predominantly with red chips, and ``blue'' bags were filled predominantly with blue chips; the proportion of colors in each bag type was known to the subjects and manipulated experimentally. The subjects were told that one of the bags was randomly selected and a set of chips was randomly drawn from that bag. They then had to judge the probability that the observed chips came from each bag, by distributing 100 metal washers between two pegs. The proportion of washers on each peg was taken to be the subjective report of the corresponding probability. Closely related studies by Peterson and colleagues used a continuous slider as the response apparatus \citep{peterson1965sample,peterson1965sensitivity,peterson1964uncertainty}. It is important to emphasize that in these studies, subjects were given all the relevant information about the data-generating process necessary for computing the posterior. Thus, there should be no learning about the parameters of this process (i.e., the prior and likelihood).

Early on, it was evident that subjects were not exactly following Bayes' rule in these experiments, despite being given all the information needed to compute it. In particular, subjects consistently under-reacted to the evidence, revising their beliefs less than mandated by Bayes' rule (a phenomenon commonly referred to as ``conservatism,'' though we avoid this term for reasons explained in the Introduction). This phenomenon was robust across many variations of the basic experimental paradigm; later we will discuss a number of factors that influence the degree of under-reaction.

Several hypotheses about the origin of under-reaction were put forth \citep[for a comprehensive review, see][]{benjamin18}. One hypothesis held that subjects compute Bayes' rule correctly, but had an inaccurate understanding of the underlying sampling distributions. Formally, subjects can be modeled as reporting the following biased posterior $\pi(h|d)$:
\begin{align}
    \pi(h|d) = \frac{\pi(d|h)P(h)}{\sum_{h'} \pi(d|h') P(h')}
\end{align}
where biases in the posterior are driven by biases in the subjective sampling distribution $\pi(d|h)$. To accommodate the existence of under-reaction, subjects would need to assume subjective sampling distributions that were flatter (more dispersed) than the objective distributions. \citet{edwards1968conservatism} proposed that the subjective sampling distribution could be modeled as:
\begin{align}
    \pi(d|h) = \frac{[P(d|h)]^\omega}{\sum_{d'} [P(d'|h)]^\omega}.
\end{align}
The parameter $\omega$ controls the dispersion of the sampling distribution. When $\omega=1$, the subjective and objective sampling distributions coincide. Under-reaction occurs when $\omega<1$.

The biased sampling distribution hypothesis was supported by the observation that subjective sampling distributions were indeed flatter than the objective ones, and substituting these beliefs into Bayes' rule accorded well with reported posterior beliefs \citep{peterson1968sampling,wheeler1968subjective}. On the other hand, a critical weakness of this hypothesis is that it cannot explain the existence of under-reaction with a sample size of 1, which would require that subjects disbelieve the experimenter when they are explicitly told the sampling distribution (i.e., the proportion of red chips in the bag). Moreover, even when subjective sampling distributions are entered into Bayes' rule, under-reaction is still sometimes observed \citep[e.g.,][]{grinnell1971bayesian}.

These weaknesses of the biased sampling distribution hypothesis motivated the alternative hypothesis that subjects are systematically under-weighting the likelihood \citep{phillips1966conservatism}, what \citet{edwards1968conservatism} referred to as ``conservatism bias.'' This hypothesis can be formalized using a generalized version of Bayes' rule:
\begin{align}
    P(h|d) \propto \frac{[P(d|h)]^\gamma P(h)}{\sum_{h'} [P(d|h')]^\gamma P(h')},
    \label{eq:bias}
\end{align}
where $\gamma$ is a free parameter specifying the weighting of the likelihood. Note that this model is superficially similar to \citet{edwards1968conservatism}'s formalization of the biased sampling distribution hypothesis, and in fact $\omega = \gamma$ when the denominator of $\pi(d|h)$ ($\sum_{d'} [P(d'|h)]^\omega$) is constant as a function of $h$ (for example, in symmetric problems, where the proportion of red chips in red bags is one minus the proportion of red chips in blue bags). However, the psychological interpretation is different: the biased sampling distribution hypothesis assumes that bias enters at the level of the sampling distribution representation, whereas the conservatism bias hypothesis assumes that bias enters when subjects combine the prior and likelihood. Thus, conservatism bias offers no explanation for why subjective sampling distributions should be biased. It can, however, accommodate the fact that under-reaction occurs for sample sizes of 1, because it posits that even explicit knowledge of the sampling distribution will not prevent biased updating. Likewise, it accommodates the observation that under-reaction is still sometimes observed when subjective sampling distributions are entered into Bayes' rule.

A third hypothesis, first proposed by \citet{ducharme1970response}, is a form of ``extreme belief aversion'' \citep[see also][]{benjamin18}. If subjects avoid reporting extreme beliefs, then large posterior odds will be pulled towards 0. Consistent with this hypothesis, \citet{ducharme1970response} found that subjective odds coincided with the true posterior odds only for posterior odds between $-1$ and $1$; outside this range, subjective odds were systematically less extreme than posterior odds. A weakness of the extreme belief aversion hypothesis, at least in its most basic form, is that it assumes a fixed transformation of the true posterior, which means that it cannot account for experiments in which under-reaction changes across conditions while the true posterior is held fixed \citep[e.g.,][]{griffin1992weighing,kraemer2004people,benjamin2016model}.

The literature on under-reaction to evidence faded away without a satisfactory resolution, in part because research was driven towards the study of under-reaction to priors by the work of Kahneman and Tversky  \citep{kahneman1973psychology,kahneman1972subjective}. Instead of using laboratory-controlled scenarios involving bags filled with poker chips, \citet{kahneman1973psychology} invoked more realistic scenarios such as the following:
\begin{quote}
    Jack is a 45 year old man. He is married and has four children. He is generally conservative, careful, and ambitious. He shows no interest in political and social issues and spends most of his free time on his many hobbies which include home carpentry, sailing, and mathematical puzzles.
\end{quote}
One group of subjects was told that Jack is one of 100 individuals, 30 of whom are lawyers, and 70 of whom are engineers. Another group of subjects was told that 70 of the individuals were lawyers and 30 were engineers. Kahneman and Tversky found that subjects were largely insensitive to this manipulation: subjects in the first group reported, on average, that the posterior probability of Jack being an engineer was 0.5, and subjects in the second group reported a posterior probability of 0.55. Thus, subjects clearly under-reacted to prior probabilities---i.e., they exhibited \emph{base rate neglect}.\footnote{Although base rate neglect was popularized by Kahneman and Tversky's work, it was in fact documented earlier using the poker chip paradigm \citep{phillips1966conservatism}, but this observation was mostly ignored by subsequent research using that paradigm.}

Many subsequent studies have reported under-reaction to priors, though the interpretation of these studies has been the focus of vigorous debate \citep[see][]{koehler1996base,barbey2007base}. It has been observed in incentivized experiments \citep[e.g.,][]{grether1980bayes,ganguly2000asset}, in real-world markets \citep{barberis1998model}, and in highly trained specialists such as clinicians \citep{eddy1982probabilistic} and psychologists \citep{kennedy1997base}.

In addition to establishing the empirical evidence for under-reaction to priors, \citet{kahneman1972subjective} also proposed the most influential account of its psychological origin. They argued that instead of following Bayes' rule, people may use a \emph{representativeness heuristic}, judging the probability of a hypothesis based on the similarity between the observed data and ``representative'' data under that hypothesis. For example, the vignette describing Jack is intuitively more representative of engineers than it is of lawyers. If people judge the probability of category membership based solely on representativeness, then they will neglect the prior probability of lawyers and engineers in the population, consistent with Kahneman and Tversky's results.

To capture under-reaction to priors formally, the model introduced in Eq.~\ref{eq:bias} can be generalized to allow insensitivity to the prior \citep{grether1980bayes}:
\begin{align}
    P(h|d) \propto \frac{[P(d|h)]^{\alpha_L} P(h)^{\alpha_P}}{\sum_{h'} [P(d|h')]^{\alpha_L} P(h')^{\alpha_P}},
    \label{eq:bias2}
\end{align}
As before, $\alpha_L<1$ implies insensitivity to the likelihood; in addition, $\alpha_P<1$ implies insensitivity to the prior (base rate neglect). \citet{grether1980bayes} referred to the case in which $\alpha_L>\alpha_P>0$ as the \emph{representativeness hypothesis}. 

In the special case where $\alpha_L=1$ and $\alpha_P=0$, the posterior is simply the normalized likelihood. This corresponds to the model of representativeness judgments proposed by \citet{tenenbaum2001rational} in the case where there are two mutually exclusive hypotheses. This model accounts for why two observations can have the same likelihood but differ in their perceived representativeness. For example, a fair coin is equally likely to generate the sequences HHHH and HTHT (where ``H'' denotes heads and ``T'' denotes tails), but people intuitively perceive the latter sequence as more representative of a fair coin. Similarly, people perceive ``being divorced 4 times'' as more representative of Hollywood actresses than ``voting Democractic,'' even though the latter has a higher likelihood \citep{tversky1983extensional}.

The model put forward by Tenenbaum and Griffiths formalizes the idea that representativeness is tied to \emph{diagnosticity}: the extent to which the data are highly probable under one hypothesis and highly improbable under an alternative hypothesis. \citet{gennaioli2010comes} offered a different formalization of representativeness that also captures the notion of diagnosticity. They model probability judgments based on consideration of data that are accessible in memory \citep[see also][]{dougherty1999minerva}. Judgmental biases arise when an agent engages in ``local thinking'' (retrieving data from memory based on its diagnosticity). This resonates with modern theories of episodic memory, which posit that the retrievability of information is related to its distinctiveness; under the assumption that information is stored and/or retrieved probabilistically, distinctiveness is directly related to diagnosticity \citep{mcclelland1998familiarity,shiffrin1997model}.
Consistent with the diagnosticity hypothesis, \citet{fischhoff1984diagnosticity} showed greater under-reaction to the evidence when diagnosticity was higher \citep[see also][]{bar1980base,ofir1988pseudodiagnosticity}. However, a meta-analysis by \citet{benjamin18} showed that most studies actually find the opposite pattern: under-reaction to the evidence is positively correlated with diagnosticity. One goal of our theoretical account is to resolve this discrepancy.

While much of the work on under-reaction to the prior discussed above was largely driven by findings in more `realistic' scenarios, such effects are also found in more laboratory-controlled paradigms like those in \citet{peterson1964mode} and \citet{edwards1968conservatism}. In particular, when the parameters of the model in Equation \ref{eq:bias2} are fit to behavioral data from studies using such laboratory-controlled stimuli, the value of $\alpha_P$ is generally between 0 and 1 -- indicating that subjects sometimes under-weight the prior in these cases as well, but do not neglect it completely \citep{benjamin18}. This formulation therefore allows for the case where both $\alpha_P$ and $\alpha_L$ are less than 1, corresponding to a version of the ``system neglect'' hypothesis proposed by \citet{massey2005detecting}: both the likelihood and prior are neglected, producing an overall insensitivity to variations in the data-generating process. An important implication is that the two forms of under-reaction are compatible (one can under-react to both the likelihood and the prior) and could potentially be explained by a unified model, with similar mechanisms acting across these different domains. A goal of our theoretical account is to understand when under-reaction occurs and when such under-reaction to one source is more prominent than under-reaction to the other.

In summary, the literature on probabilistic belief updating has produced evidence for under-reaction to both prior probabilities and evidence. We now turn to the development of a theoretical account that will explain several aspects and properties of these and other errors.

\section{Learning to infer}

To understand why people make inferential errors, we need to start by understanding why inference is hard, and what kinds of algorithms people could plausibly use to find approximate solutions. We will therefore begin this section with a general discussion of approximate inference algorithms, identify some limitations of these algorithms (both computationally and cognitively), and then introduce the \emph{learning to infer} framework, which addresses these limitations. This framework provides the basic principles needed to make sense of under-reaction.

\subsection{Approximate inference}

The experiments discussed above involved very simple (mostly binary) hypothesis spaces where Bayes' rule is trivial. But in the more realistic domains that humans commonly confront, the hypothesis space can be vast. 

For example, consider a clinician diagnosing a patient. A patient can simultaneously have any of $N$ possible conditions. This means that the hypothesis space contains $2^N$ hypotheses. Or consider the segmentation problem, faced constantly by the visual system, of assigning each retinotopic location to the surface of an object. If there are $K$ objects and $N$ locations, the hypothesis space contains $K^N$ hypotheses. Such vast hypothesis spaces render exact computation of Bayes' rule intractable, because the denominator (the normalizing constant, sometimes called the partition function or marginal likelihood) requires summation over all possible hypotheses.

Virtually all approximate inference algorithms address this problem by circumventing the calculation of the normalizing constant \citep{gershman2017complex}. For example, Monte Carlo algorithms \citep{andrieu2003introduction} approximate the posterior using $M$ weighted samples $\{h^1,\ldots,h^M\}$:
\begin{align}
    P(h|d) \approx \sum_{m=1}^M w^m \mathbb{I}[h^m = h],
    \label{eq:montecarlo}
\end{align}
where $w^m$ is the weight attached to sample $m$, and $\mathbb{I}[\cdot]=1$ if its argument is true (0 otherwise). Markov chain Monte Carlo algorithms, generate these samples from a Markov chain whose stationary distribution is the posterior, and the weights are uniform, $w^m = 1/M$. The Markov chain is constructed in such a way that the transition distribution does not depend on the normalizing constant. Importance sampling algorithms generate samples simultaneously from a proposal distribution $\tilde{P}(h)$, with weights given by $w^m = P(d|h^m)P(h^m)/\tilde{P}(h^m)$.

Most cognitive theories of approximate inference have appealed to some form of Monte Carlo sampling, for several reasons. First, they can explain response variability in human judgments as arising from randomness in the sampling process \citep{denison2013rational,vul2014one,gershman2012multistability}. Second, they can explain a wide range of inferential errors, ranging from subadditivity to the conjunction fallacy \citep{sanborn2016bayesian,dasgupta2017hypotheses}. Third, they can be implemented in biologically plausible circuits with spiking neurons \citep{buesing2011neural,orban2016neural,haefner2016perceptual}.

Monte Carlo algorithms can be thought of as procedures for generating an approximate posterior $Q_\phi(h|d)$ parametrized by the set of weights and samples, $\phi = \{ w^m, h^m \}_{m=1}^M$. The superset $\Phi$ of all feasible sets (i.e., the sets that can be produced by a particular Monte Carlo algorithm) defines an approximation family. This leads us to a more general view of approximate inference as an optimization problem: find the approximation (parametrized by $\phi \in \Phi$) that gets ``closest'' to the true posterior,
\begin{align}
\phi^\ast = \argmin_{\phi \in \Phi} \mathcal{D}[Q_\phi(h|d)||P(h|d)],
\end{align}
where dissimilarity between the two distributions is measured by a divergence functional $\mathcal{D}$. Most Monte Carlo algorithms do not directly solve this optimization problem, but instead randomly sample $\phi$ such that, in the limit $M \rightarrow \infty$, they produce $\phi^\ast$. It is however possible to design non-randomized algorithms that directly optimize $\phi$ \citep{saeedi2017variational} in a sample-based approximation. Such optimization is an example of \emph{variational inference} \citep{jordan1999introduction}, because the solution can be derived using the calculus of variations. The most commonly used divergence functional is the Kullback-Leibler (KL) divergence (also known as the relative entropy):
\begin{align}
\mathcal{D}_{\text{KL}}[Q_\phi(h|d)||P(h|d)] = \sum_h Q_\phi(h|d) \log \frac{Q_\phi(h|d)}{P(h|d)}.
\end{align}
% Most Monte Carlo algorithms do not directly solve the variational optimization problem, but instead randomly sample $\phi$ such that, in the limit $M \rightarrow \infty$, they produce $\phi^\ast$. It is also possible to design non-randomized algorithms that directly optimize $\phi$ \citep{saeedi2017variational}.

The variational optimization view of approximate inference allows us to consider more general approximation families that go beyond weighted samples. In fact, the approximate posterior can be any parametrized function that defines a valid probability distribution over the relevant hypothesis space. For example, researchers have used deep neural networks as flexible function approximators \citep{dayan1995helmholtz,kingma2014auto,mnih2014neural,rezende2015variational,paige2016inference}. From a neuroscience perspective, this approach to approximate inference is appealing because it lets us contemplate complex, biologically realistic approximation architectures \citep[provided that the optimization procedures can also be realized biologically; see][]{whittington2019theories}. For example, particular implementations of variational inference have been used to model hierarchical predictive coding in the brain \citep{friston2008hierarchical,gershman2019does}.

\subsection{Amortization}

Most approximate inference algorithms are \emph{memoryless}: each time the system is queried (i.e., given data and asked to return the probability of a hypothesis or subset of hypotheses), the inference engine is run with a fresh start, oblivious to any computations it carried out before. This has the advantage that the algorithm will be unbiased, and hence with enough computation the parameters can be fine-tuned for the current query. But memorylessness can also be colossally wasteful. Consider a doctor who sees a series of patients. She could in principle recompute her posterior from scratch for each set of observed symptoms. However, this would fail to take advantage of computational overlap across diagnostic queries, which would arise if multiple patients share symptom profiles. To address this problem, computer scientists have developed a variety of \emph{amortized inference} algorithms that reuse computations across multiple queries \citep{dayan1995helmholtz,kingma2014auto,mnih2014neural,rezende2015variational,paige2016inference,stuhlmuller2013learning,eslami2014just,wang2018meta,rosenthal2011optimal,marino2018learning}.

To formalize this idea, let the data variable $d$ subsume not only the standard ``observation'' (e.g., symptoms in the diagnostic example) but also the information provided to the agent about the generative model $P(d,h)$ and the subset of the hypothesis space being queried (e.g., a particular diagnostic test, which is a subset of the joint diagnosis space). In the ``classical'' approximate inference setting, the inference engine computes a different approximate posterior for each query, with no memory across queries. In the amortized setting, we allow sharing of parameters across queries (Figure~\ref{fig:amo_schematic}). Optimizing these parameters induces a form of memory, because changes to the parameter values in response to one query will affect the approximations for other queries. Put simply, the amortized inference engine \emph{learns to infer}: it generalizes from past experience to efficiently compute the approximate posterior conditional on new data.

\begin{figure}
\captionsetup[subfigure]{justification=centering}
\centering
  \subfloat[Memoryless inference]{% 
      \includegraphics[width=0.48\textwidth]{Figures/memoryless0.png}} 
  \subfloat[Amortized inference]{% 
    \includegraphics[width=0.48\textwidth]{Figures/amortized0.png}} 
    
  \subfloat[Learned Inference Model with 1 hidden unit]{% 
    \includegraphics[width=0.48\textwidth]{Figures/LIM1.png}} 
  \subfloat[Learned Inference Model with 5 hidden units]{% 
    \includegraphics[width=0.48\textwidth]{Figures/LIM5.png}} 
\caption{\textbf{Schematics of different inference methods}. (A) Memoryless inference recomputes the variational parameters $\phi$ from scratch for each new set of observations, resulting in an approximate posterior $Q_\phi$ that is unique for each $d$. (B) Amortized inference allows some variational parameters to be shared across queries, optimizing them such that $Q_\phi$ is a good approximation \emph{in expectation} over the query distribution. (C) Schematic of how we implemented this framework with a neural network function approximator in the Learned Inference Model, with low capacity (1 hidden unit). (D) Schematic of a neural network function approximator in the Learned Inference Model, with high capacity (5 hidden units).} 
  \label{fig:amo_schematic}
\end{figure}

The optimization problem in the amortized setting is somewhat different from the classical setting. This is because we now have to think about a distribution of queries, $P(q)$. One way to formalize this problem is to define it as an expectation under the query distribution $P_\text{query}(d)$:
\begin{align}
\phi^\ast = \argmin_{\phi \in \Phi} \mathbb{E}_{P_\text{query}}\left\{ \mathcal{D}[Q_\phi(h|d)||P(h|d)] \right \}
\label{eq:amort}
\end{align}
Under this objective function, high probability queries will exert a stronger influence on the variational parameters (see Figure~\ref{fig:query_schematic} for an illustration). Note that $P_\text{query}(d)$ need not be identical to the true marginal probability of the data under the data-generating process, $P(d)$. For example, a child might ask you a series of questions about the reproductive habits of squirrels, but observations of these habits might be rare in your experience.

It is important to note that classical (non-amortized) approximate inference is a special case of amortized inference, and if there are no constraints on the amortization architecture, then the optimal architecture will not do any amortization. This means that amortization only becomes relevant when there are computational constraints that force sharing of variational parameters---i.e., limitations on the function approximator's capacity. A key part of our argument is that the brain's inference engine operates under such constraints \citep[see][]{feng2014multitasking,alon2017graph}, which will produce the kinds of inferential errors we wish to explain.

\begin{figure}
\centering
  \subfloat[True posterior P]{% 
      \includegraphics[width=0.33\textwidth]{Figures/all_posts.png}} 
    \hfill
  \subfloat[Approximate posterior Q]{% 
    \includegraphics[width=0.33\textwidth]{Figures/all_finalQs.png}} 
  \subfloat[KL$ \lbrack Q||P \rbrack$]{% 
    \includegraphics[width=0.33\textwidth]{Figures/all_KLs.png}} 
  \caption{\textbf{Schematic demonstration of how the approximate posterior depends on the query distribution}. (A) The true posterior probability $P$ (indicated by colors on the heatmap), as a function of the prior and likelihood for a generative model in which $h \sim \text{Bernoulli}(p_0)$ and $d|h \sim \text{Bernoulli}(p_l)$. The contour lines depict the query distribution. (B) The approximate posterior $Q$ computed by the Learned Inference Model, averaged over the query distribution. The approximation is better for areas that are sufficiently covered by the query distribution. (C) The average KL divergence between the true and approximate posteriors. Higher divergence occurs in areas that are covered less by the query distribution.
} 
  \label{fig:query_schematic}
\end{figure}

\subsection{The Learned Inference Model}

We implement a specific version of this general framework, which we refer to as the \emph{Learned Inference Model} (LIM). This model uses a three-layer feedforward neural network as the function approximator (see Figure \ref{fig:amo_schematic} C-D, further details can be found in Appendix \ref{app:LTI_arch}). The inputs are all the relevant information about the query subsumed by the data variable $d$, and the outputs uniquely determine an approximate distribution $Q_\phi(h|d)$ over all hypotheses $h$. For example, if we want to model the posterior distribution $P(h|d)$ as a Bernoulli distribution over two hypotheses, then the inputs are the prior probabilities of the two hypotheses, the likelihood parameters, and observed data, while the output is a Bernoulli parameter that represents the approximate posterior. The same parameters of the network $\phi$ are used to generate the approximate distributions $Q_\phi(h|d)$ for all queries $d$ (i.e., the approximation is amortized; Figure \ref{fig:amo_schematic} A-B). The network encounters a series of queries $d$ and outputs a guess for $Q_\phi(h|d)$. This guess is improved in response to each new d, with updates to the network parameters $\phi$. This leads to query dependence (Figure \ref{fig:query_schematic}) in the learned parameters $\phi$, and therefore in the approximation $Q_\phi(h|d)$. The updates to $\phi$ are made using an algorithm that performs that performs the optimization in Equation \ref{eq:amort} using knowledge only of the joint distribution as a learning signal (see \citet{ranganath2014black}, also discussed in Chapter \ref{chap:approx}, for details). Since the joint distribution is known, no external feedback is necessary for learning.

These implementational details were chosen for simplicity and tractability. Because many other choices would produce similar results, we will not make a strong argument in favor of this particular implementation. For our purposes, a neural network is just a learnable function approximator, utilizing the memory of previously sampled experience to approximate future posteriors. Several other memory-based based process models for probability judgment \citep[for example:][]{dougherty1999minerva, shi2010exemplar, dasgupta2018remembrance, stewart2006decision, hertwig2009description} could also learn to infer. Nonetheless, the implementation fulfills several intuitive desiderata for a psychological process model. First, feedforward neural networks have been widely used to model behavioral and neural phenomena. Most relevant to the present approach is the work of \citet{orhan2017efficient}, who showed how generic neural networks could be trained to implement probabilistic computation. These architectures can also act as universal function approximators, allowing us to refrain from strong assumptions about the functional form of the inference procedures it will learn, while simultaneously retaining reasonable generalization properties and protection from too much overfitting, despite high expressivity\citep{zhang2016understanding, neyshabur2017exploring}. Second, neural networks offer a natural way to specify the computational bottleneck in terms of a convergent pathway (the number of hidden units is smaller than the number of input units)\footnote{In this parallel, the network in our LIM is not intended to represent an actual network of neurons in the brain per se, and the convergent bottlenecks induced are not intended as a literal number of neurons in a natural neural network. Real networks in the brain receive information in much higher dimensional format, where the relevant variables are yet to be isolated. Further, they have to cope with noise on these inputs, in the learning signal, and the even the neurons themselves are stochastic. Our model is a highly idealized version of the computations underlying probabilistic judgment, and specifics like the number of units in the bottleneck or the number of layers etc. cannot be directly compared to biologically realistic analogs.}. Such convergence has played an important role in theorizing about other forms of cognitive bottlenecks \citep[e.g.,][]{feng2014multitasking,alon2017graph}. Third, the learning rule (blackbox variational inference) can be applied incrementally, and does not require knowledge of the posterior normalizing constant, making it cognitively plausible. Fourth, as we discuss later, the model can be naturally integrated with Monte Carlo sampling accounts of approximate inference.

All model parameters (number of hidden units in the bottleneck, the architecture of the network, properties of the optimization algorithm, etc.) are fixed across almost all the experiments (see Appendix \ref{app:LTI_arch} for details); any exceptions are noted where relevant. All the key predictions our model makes are qualitative in nature, and do not require fitting of free parameters to empirical results.

\section{Understanding under-reaction}

We now apply the Learned Inference Model to our motivating question: what is the origin of under-reaction to prior probabilities and evidence? We argue that these inferential errors arise from an amortized posterior approximation. There are two key elements of this explanation. First, the amortized approximation has \emph{limited capacity}: it can only accurately approximate a restricted set of posteriors, due to the fact that the approximation architecture has a computational bottleneck (in our case, a fixed number of units in the hidden layer). We will see how this leads to overall under-reaction to both priors and evidence. Second, the particular posteriors that can be accurately approximated are those that have high probability under the query distribution. We will see how this leads to differential under-reaction to either prior or evidence. In this section, we will focus on the first element (limited capacity), since most of the experiments that we focus on use near-uniform query distributions. We address the second element (dependence on the query distribution) in subsequent sections.

\citet{benjamin18} presented a meta-analysis of studies using the classical balls-in-urns setup, or similar setups (e.g., poker chips in bags). For simplicity, we will use the ball-in-urns setup to describe all of these studies. Subjects are informed that there are two urns (denoted R and B) filled with some mixture of blue and red balls. On each trial, an urn $h$ is selected based on its prior probability $P(h)$, and then a data set $d = (N_r,N_b)$ of $N_r$ red balls and $N_b$ blue balls is drawn from $P(d|h)$ by sampling $N = N_r+N_b$ balls with replacement from urn $h$. The subject's task is to judge the posterior probability of urn R, $P(h=R|d)$. Urn R contains mostly red balls (red-dominant), and the urn B contains mostly blue balls (blue-dominant). Following \citet{benjamin18}, we focus on symmetric problems, where the proportion of the dominant color in both urns is denoted by $\theta$, which is always greater than $0.5$. We can also interpret $\theta$ as the \emph{diagnosticity} of the likelihood: when $\theta$ is large, the urns are easier to tell apart based on a finite sample of balls.

In formalizing a model for subjective performance on this task, \citet{benjamin18} follows \citet{grether1980bayes} in allowing separate parameters for sensitivity to the likelihood and the prior (Eq.~\ref{eq:bias2}). For analytical convenience, this model can be reformulated as linear in log-odds:
\begin{align}
    \log\frac{P(h = R| d)}{P(h=B| d)} = 
    \alpha_P \log \frac{P(h=R)}{P(h=B)}  +
    \alpha_L\log \frac{P(d | h=R)}{P(d |h=B)} + \epsilon,
    \label{eq:sysneg}
\end{align}
where we have included a random response error term $\epsilon$. This formulation allows us to obtain maximum likelihood estimates $\hat{\alpha}_P$ and $\hat{\alpha}_L$ using least squares linear regression applied to subjective probability judgments (transformed to the log-odds scale). \citet{benjamin18} first restricted the meta-analyses to studies with equal prior probabilities across the hypotheses, such that $\alpha_P$ is irrelevant. The estimates of $\alpha_L$ revealed three main findings: (i) Under-reaction to the likelihood is more prevalent ($\hat{\alpha}_L<1$); (ii) the extent of under-reaction to the likelihood is greater ($\hat{\alpha}_L$ is lower) with larger sample size (high $N$); and (iii) the extent of under-reaction is greater with higher diagnosticity (higher $\theta$) of the likelihood.


\afterpage{\begin{LSFigure}%
\centering
\includegraphics[width=0.8\linewidth, keepaspectratio=true]{Figures/Benjamin_hor_new.pdf}%
\caption{\textbf{Simulation of inferential errors in binary symmetric problems with uniform priors}. $P(h | d)$ represents true  posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. (A) Data aggregated by \citet{benjamin18}. (B) Learned  Inference Model simulations. Left: subjective posterior log-odds vs. Bayesian posterior log-odds. Middle: estimated sensitivity to  the likelihood $\hat{\alpha}_L$ vs sample size $N$. Right: estimated sensitivity to the likelihood vs. diagnosticity $\theta$. The shaded curves show the  linear and nonlinear (LOESS) regression functions with 95\% confidence bands}
\label{fig:Benj}
\end{LSFigure}}


We investigated whether the Learned Inference Model can capture these findings. For each experimental condition, collected from 15 experiments, we trained the model with 2 hidden units on the same stimuli presented to subjects. The conditions varied in likelihood diagnosticity ($\theta$) and sample size ($N$). We additionally include some uniformly random sample sizes and diagnosticities in training as a proxy for subjects' ability to simulate other possible values for these query parameters, apart from the small set of specific ones chosen by the experimenters\footnote{Crucially however, the stimuli actually used in the experiment are much better represented in the query distribution during training -- leading to differences in the predictions made by the Learned Inference Models trained on different query distributions from each experiment. The uniformly random inputs primarily serve to add some noise to prevent the Learned Inference Model from overfitting in cases where the experimental stimuli only query a very small number of unique sample sizes and diagnosticities.}. We found that the Learned Inference Model could successfully reproduce the 3 main findings from the \citet{benjamin18} meta-analysis (Figure~\ref{fig:Benj}).
%
%
% \begin{landscape}
%\vspace*{\fill}
%\begin{figure}[htpb]
%  \includegraphics[height=0.6\textheight, width=1.5\textwidth]{Figures/Benjamin_hor_new.pdf}
%  \caption{\textbf{Simulation of inferential errors in binary symmetric problems with uniform priors}. $P(h | d)$ represents true \newline posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. (A) Data aggregated by \citet{benjamin18}. (B) Learned \newline Inference Model simulations. Left: subjective posterior log-odds vs. Bayesian posterior log-odds. Middle: estimated sensitivity to \newline the likelihood $\hat{\alpha}_L$ vs sample size $N$. Right: estimated sensitivity to the likelihood vs. diagnosticity $\theta$. The shaded curves show the \newline linear and nonlinear (LOESS) regression functions with 95\% confidence bands}}
%\end{figure}
%\vfill
%\end{landscape}
%
%
%
%\begin{FPfigure}%
%\centering
%\includegraphics[ width=1.02\textheight, keepaspectratio=true]{Figures/Benjamin_hor_new.pdf}%
%\caption{\textbf{Simulation of inferential errors in binary symmetric problems with uniform priors}. $P(h | d)$ represents true  posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. (A) Data aggregated by \citet{benjamin18}. (B) Learned  Inference Model simulations. Left: subjective posterior log-odds vs. Bayesian posterior log-odds. Middle: estimated sensitivity to  the likelihood $\hat{\alpha}_L$ vs sample size $N$. Right: estimated sensitivity to the likelihood vs. diagnosticity $\theta$. The shaded curves show the  linear and nonlinear (LOESS) regression functions with 95\% confidence bands}
%\label{fig:fftQCboxplot}%
%\end{FPfigure}%


%
%\begin{sidewaysfigure}%
%\thispagestyle{empty}
%\centering
%\includegraphics[ width=1.02\textheight, keepaspectratio=true]{Figures/Benjamin_hor_new.pdf}%
%\caption{\textbf{Simulation of inferential errors in binary symmetric problems with uniform priors}. $P(h | d)$ represents true  posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. (A) Data aggregated by \citet{benjamin18}. (B) Learned  Inference Model simulations. Left: subjective posterior log-odds vs. Bayesian posterior log-odds. Middle: estimated sensitivity to  the likelihood $\hat{\alpha}_L$ vs sample size $N$. Right: estimated sensitivity to the likelihood vs. diagnosticity $\theta$. The shaded curves show the  linear and nonlinear (LOESS) regression functions with 95\% confidence bands.  {\raisebox{0cm}{\thepage}}}
%\label{fig:Benj}%
%\end{sidewaysfigure}%

% \newpage


\begin{figure}
\centering
      \includegraphics[width=0.97\textwidth]{figures/Benjamin_prior.pdf}
  \caption{\textbf{Simulation of inferential errors in binary symmetric problems with non-uniform priors}. $P(h | d)$ represents true posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. Plots show prior log-odds on the x axis, and the subjective prior log-odds calculated as the subjective posterior log-odds adjusted for subjective response to the likelihood (as modulated by $\hat{\alpha}_L$). (A) Data aggregated by \citet{benjamin18}. (B) Simulation with low-capacity (2 hidden nodes) Learned Inference Model. (C) Simulation with high-capacity (8 hidden nodes) Learned Inference Model. The shaded curves show the linear and nonlinear (LOESS) regression functions with 95\% confidence bands.} 
  \label{fig:Benj_prior}
\end{figure}

We also applied the model to experiments in which the prior distribution was non-uniform (deviated substantially from $0.5$). Figure \ref{fig:Benj_prior} shows data aggregated by \citet{benjamin18} along with model simulations, demonstrating that both people and the model tend to be insufficiently sensitive to the prior odds ($\hat{\alpha}_P < 1$), consistent with base rate neglect.

We have shown that several of the main findings in the \citet{benjamin18} meta-analysis of inferential errors can be reproduced by the Learned Inference Model with limited capacity. We now build an intuition for how the model explains these phenomena. The key idea is that limited capacity forces the model to sacrifice some fidelity to the posterior, producing degeneracy: some inputs map to the same outputs \citep[see][for a similar argument]{massey2005detecting}. This degeneracy can be seen in Figure \ref{fig:Benj}, where posterior log-odds greater than +5 or less than -5 are mapped to almost the same approximate log-odds value. Degeneracy causes under-reaction overall to sources of information (like sample size, prior and likelihood). It also causes the approximate posteriors at extreme log-odds to suffer relatively greater deviations from the true posterior, in particular greater under-reaction to sources of information when the log-odds are extreme (e.g., with larger sample sizes and more diagnostic likelihoods). Intuitively, degeneracy causes the model to have a relatively flat response as a function of the posterior log-odds, which means that deviations will also increase with the posterior log-odds.

\begin{figure}
\centering
      \includegraphics[width=0.97\textwidth]{figures/Benjamin_control_hor.pdf}
  \caption{\textbf{Simulations of inferential errors with high capacity and a biased query distribution}. $P(h | d)$ represents true posterior probabilities, $Q(h | d)$ represents subjective posterior probabilities. (A) Simulation of high-capacity (8 hidden units) Learned Inference Model. (B) Simulation of low-capacity (2 hidden units) Learned Inference Model with biased query distribution. Left: subjective posterior log-odds vs. Bayesian posterior log-odds. Middle: estimated sensitivity to the likelihood $\hat{\alpha}_L$ vs. sample size $N$. Right: estimated sensitivity to the likelihood vs. diagnosticity $\theta$. The shaded curves show the linear and nonlinear (LOESS) regression functions with 95\% confidence bands.} 
  \label{fig:Benj_control}
\end{figure}

To demonstrate that these biases in our model are indeed caused by limited capacity in the network, we repeated the same simulations with greater capacity (8 hidden units instead of 2). In this case, we found that the approximate posterior mapped almost exactly to the true posterior (Figure \ref{fig:Benj_control}A, left). Estimated sensitivity to the likelihood ($\hat{\alpha}_L$) across all diagnosticities and sample sizes was very close to the Bayesian optimal of 1 (Figure \ref{fig:Benj_control}A middle and right). We also found that higher capacity mostly abolished base rate neglect (Figure \ref{fig:Benj_prior}C).

What information is lost by a limited capacity approximation depends on the query distribution. To examine this point more closely, we simulated the Learned Inference Model (with 2 hidden units) trained on a biased query distribution, where the likelihood parameters, prior probabilities and sample sizes were the same as used in training previously, but the queries were manipulated such that $90\%$ of the time the data were uninformative about which urn is more likely---i.e., the difference in the number of red and blue balls was close to zero. The query distribution therefore is very peaked around zero likelihood log-odds. We then tested the model on the same queries simulated in Figure \ref{fig:Benj}. As shown in the left panel of Figure \ref{fig:Benj_control}B (note the change in y axis scale), the approximation is still close to Bayes-optimal near zero posterior log-odds, but the extent of degeneracy is overall far greater, with all the true posterior log-odds being mapped to approximate posterior log-odds roughly between -1 and +1. This results in much greater under-reaction overall. This is also reflected in Figure \ref{fig:Benj_control}B, middle and right, where the estimated sensitivity $\hat{\alpha}_L$ is closer to zero.

\subsection{The effect of sample size}

In this section, we consider the effect of sample size on the posterior distribution in greater detail, keeping the prior and likelihood parameters fixed. The most systematic investigation of sample size was reported by \citet{griffin1992weighing}, who suggested a specific decomposition of the posterior log-odds into the \emph{strength} (sample proportion) and the \emph{weight} (sample size) of the evidence. These are two sources of information that inform the posterior, and we can consider how strongly participants react to these the same way we consider their reactions to the prior and evidence in the previous section.

In one of their studies, they gave subjects the following instructions:
\begin{quote}
Imagine that you are spinning a coin, and recording how often the coin lands heads and how often the coin lands tails. Unlike tossing, which (on average) yields an equal number of heads and tails, spinning a coin leads to a bias favoring one side or the other because of slight imperfections on the rim of the coin (and an uneven distribution of mass). Now imagine that you know that this bias is 3/5. It tends to land on one side 3 out of 5 times. But you do not know if this bias is in favor of heads or in favor of tails. 
\end{quote}
After being shown different sets of coin ``spin'' results that varied in the number of total spins and the number of observed heads (see Table \ref{tab:GT}), subjects were then asked to judge the posterior probability that the coin was biased towards heads rather than towards tails.

\begin{table}
    \centering
    \begin{tabular}{c|c}
    \toprule
         Number of heads (h) & Sample size (n)\\
      \midrule
          2 & 3 \\
          3 & 3 \\
          3& 5\\
          4& 5\\
          5& 5\\
          5& 9\\
          6& 9\\
          7& 9\\
          9& 17\\
          10& 17\\
          11& 17\\
          19& 33\\
          \bottomrule
    \end{tabular}
    \caption{Stimuli used in \citet{griffin1992weighing}.}
    \label{tab:GT}
\end{table}

The two hypotheses in this task were that the biased coin either favors heads (denoted $h=A$) or that it favors tails (denoted $h=B$). The prior probabilities of both hypotheses were equal. The symmetric binomial probability was fixed at $\theta = 3/5$, and the observed data $d=(N_a,N_b)$ is the number of heads ($N_a$) and number of tails $N_b$. The posterior log-odds can then be written as:
\begin{align}
    \log \frac{P(h=A|d)}{P(h=B|d)} =  N \left(\frac{N_a - N_b}{N} \right) \log \left( \frac{\theta}{1-\theta}\right),
\end{align}
where $N = N_a + N_b$. Taking the log of this equation results in a linear function relating the log of the posterior log-odds to evidence ``strength'' $\log\left(\frac{N_a - N_b}{N}\right)$ and ``weight'' $\log N$. Following \citet{grether1980bayes}, \citet{griffin1992weighing} allowed each component to be weighted by a coefficient ($\alpha_W$ for evidence weight, $\alpha_S$ for evidence strength), absorbed all constants into a fixed intercept term $\alpha_0 = \log \log \left( \frac{\theta}{1-\theta} \right)$, and allowed for random response error $\epsilon$, arriving at the following regression model:
\begin{align}
    \log \left( \log \frac{P(h=A|d)}{P(h=B|d)} \right) = \alpha_0 + \alpha_W \log(N) + \alpha_S \log\left(\frac{N_a - N_b}{N} \right) + \epsilon.
\end{align}
The Bayes-optimal parametrization is $\alpha_W = \alpha_S = 1$. However, \citet{griffin1992weighing} found that both $\alpha_W$ and $\alpha_S$ significantly smaller than $1$. Furthermore, subjects tended to be less sensitive to the weight ($\hat{\alpha}_W = 0.31$) compared to the strength ($\hat{\alpha}_S = 0.81$).

We now turn to predictions from the Learned Inference Model. The actual stimuli presented to subjects in the original experiment were only a small subset of the possible data from the generative model implied by the instructions. Similarly to the previous section, we partially pre-trained the network with random samples from the generative model as follows: we sample the sample sizes from the set of stimuli used in the original experiment (Table \ref{tab:GT}), but did not fix the number of observed heads, which we sampled randomly from the generative distribution instead. This can be thought of as offline training on the generative process, which seems plausible based on the instructions given to the subjects, ans serves to regularize the Learned Inference Model by preventing overfitting. We then trained exclusively on the specific stimuli used in the original experiment, and carried out our analyses on the model's response to each query in Table \ref{tab:GT}.

Consistent with the experimental results, we found that the model was sub-optimally sensitive to both sources of information (Figure \ref{fig:samplesize}), with both $\hat{\alpha}_S$ and $\hat{\alpha}_W$ being less than 1. We also found that it was more sensitive to the strength than the weight ($\hat{\alpha}_{S} = 0.67, \hat{\alpha}_{W} = 0.48$).

\begin{figure}
    \centering
    \includegraphics[width=0.9\textwidth]{figures/GT_fulltrain.pdf}
    \caption{\textbf{Strength and weight in probabilistic judgment}. (A) Regression coefficients reported in \citet{griffin1992weighing}. (B) Regression coefficients estimated from simulations of the Learned Inference Model. Error bars represent the standard error of the mean.}
    \label{fig:samplesize}
\end{figure}

Greater sensitivity to strength than to weight in our model can be explained by considering the amount of variance explained by each of these variables. We took random samples from the generative model and measured how much of the variance in the log of the true posterior log odds can be explained by the log of the strength and the log of the weights separately. We found that the strength variable explains more of the variance in the true posterior than the weight variable (Figure \ref{fig:GTR2}A). A resource-limited approximation such as our Learned Inference Model picks up on this difference during pre-training and preferentially attends to the more informative source (i.e., the one that explains more of the variance). Moreover, we carried out these regressions with the specific stimuli used in the the experiment and found that this difference was exaggerated (Figure \ref{fig:GTR2}B), with the weight variable explaining very little of the variance in the true posteriors. Training and evaluation on a distribution where the weight explains so little of the variance in the posterior leads the model to react to the weight even less.

\begin{figure}
\centering
\captionsetup[subfigure]{justification=centering}
  \subfloat[]{% 
      \includegraphics[width=0.46\textwidth]{figures/GT_rsquare_sample.pdf}}
      \hfill
  \subfloat[]{% 
      \includegraphics[width=0.46\textwidth]{figures/GT_rsquare_stimuli.pdf}}
  \caption{\textbf{Variance explained by strength and weight independently}. These plots show regressions between the log of the strength or weight of the evidence against the log of the posterior log-odds. (A) For samples drawn from the true generative process, the strength explains more variance in the posterior. (B) For the stimuli used in \citet{griffin1992weighing}, the weight explains almost none of the variance in the log posterior log-odds, whereas the strength explains a much higher amount of the variance.
  } 
  \label{fig:GTR2}
\end{figure}

\subsection{Manipulating the query distribution}

In this section, we focus more directly on the role of the query distribution. A basic prediction of our model is that it will put more weight on either the prior or the likelihood, depending on which of the two has been historically more informative about the true posterior. We test this prediction empirically in a new experiment by manipulating the informativeness of the prior and the likelihood during a learning phase, in an effort to elicit over- and under-reaction to data in a subsequent test phase that is fixed across experimental conditions. Specifically, informativeness was manipulated through the diagnosticity of different information sources. In the informative prior/uninformative likelihood condition, the prior probabilities were more diagnostic across queries than the likelihoods, whereas in the uninformative prior/informative likelihood condition, the likelihoods were relatively more diagnostic.

\subsubsection{Subjects}
We recruited 201 subjects (93 females, mean age=34.17, SD=8.39) on Amazon Mechanical Turk. Subjects were required to have at least 100 past completed studies with a historical completion rate of 99\%. The experiment took 12 minutes on average and subjects were paid \$ 2 for their participation. The experiment was approved by the Harvard Institutional Review Board.

\subsubsection{Design and procedure}
Subjects were told they would play 10 games with 10 trials each, in which they had to guess from which of two urns a ball was sampled (i.e., which urn was more probable \emph{a posteriori}). On every round, they saw a wheel of fortune and two urns (Figure \ref{fig:urnscreen}). They were then told that the game was played by another person spinning the wheel of fortune, selecting the resulting urn, and then randomly sampling a ball from the selected urn. The wheel of fortune thus corresponded to the prior and the balls in the urns to the likelihood on each trial. Subjects were told that each trial was independent of all other trials.

\begin{figure}
\includegraphics[width=0.95\textwidth]{figures/urns.png}
\caption{\textbf{Screen shots of urn experiment}. (A) In the condition with informative priors and uninformative likelihoods, the wheel of fortune had urn probabilities of $0.7, 0.8$, or $0.9$. The proportions of blue balls in the urns was $0.5$ or $0.6$. (B) In the condition with uninformative priors and informative likelihoods, the wheel of fortune had urn probabilities of $0.5$ or $0.6$. The proportions of blue balls in the urns was $0.7, 0.8$, or $0.9$.}
\label{fig:urnscreen}
\end{figure}

Subjects were randomly assigned to one of two between-subjects conditions. One group of subjects went through 8 blocks of 10 trials each with informative priors and uninformative likelihoods (Figure \ref{fig:urnscreen}A); the other group went through 8 blocks of informative likelihoods and uninformative priors (Figure \ref{fig:urnscreen}B). We manipulated the prior distribution by changing the number of options on the wheel labeled ``left'' or ``right''. We manipulated the likelihood by changing the proportions of two different colors in both the left and the right urn. Both urns always contained 10 balls of the same colors and the proportion of colors was always exactly mirrored. For example, if the left urn had 8 red balls and 2 blue balls, then the right urn had 2 red and 8 blue balls. For the informative prior/uninformative likelihood condition, the wheel of fortune had urn probabilities (and diagnosticities $\theta$) of $0.7, 0.8$, or $0.9$, and the proportions of blue balls in the urns was $0.5$ or $0.6$. For the uninformative prior/informative likelihood condition, the wheel of fortune had urn probabilities of $0.5$ or $0.6$, and the proportions of blue balls in the urns was $0.7$, $0.8$, or $0.9$.

After the first 8 blocks, both groups of subjects went through the same test blocks. Each test block had either informative priors or informative likelihoods, with their order determined at random. We hypothesized that, if subjects learned to infer the posterior based on their experience during the training blocks, subjects who had experienced informative likelihoods would be more sensitive to the likelihood than subjects who had experienced informative priors, who would be relatively more sensitive to the prior. 

\subsubsection{Behavioral results}


We fitted a regression to subjects' responses (transformed to log-odds) during the test blocks following Eq.~\ref{eq:sysneg}. Thus, we entered the log-odds of the prior, the log-odds of the likelihood, the condition (coded as `0' for the informative prior condition, and `1' for the informative likelihood condition), as well as an interaction effect between condition and likelihood and between condition and prior. 

\begin{figure}
\includegraphics[width=0.95\textwidth]{figures/resulturns.pdf}
\caption{\textbf{Results of urn experiment}. The y-axis shows estimates for the regression coefficients $\alpha_L$ and $\alpha_P$ (see Equation \ref{eq:sysneg}), and the x-axis represents the experimental condition. (A) Subjects weighted the prior more in the informative prior than in the informative likelihood condition. (B) Subjects weighted the likelihood more in the informative likelihood than in the informative prior condition. (C) The Learned Inference Model weights the prior more in the informative prior condition as compared to in the informative likelihood condition. (D) The Learned Inference Model weights the likelihood more in the informative likelihood condition as compared in the informative prior condition. Error bars represent the standard errors of the regression coefficients.}
\label{fig:urnresults}
\end{figure}

As expected, subjects' judgments were influenced by both the prior ($\alpha_P=0.77$, $t=27.529$, $p<.001$) and the likelihood ($\alpha_L=0.92$, $t=32.68$, $p<.001$), indicating that they understand the key components of the generative process and therefore recognize and represent both of these as relevant to their final judgment. Crucially, subjects who had previously experienced informative priors reacted more strongly towards the prior than subjects who had experienced informative likelihoods (interaction effect of $\text{condition}\times\alpha_P=0.10$,$t=2.44$, $p=.01$, Figure~\ref{fig:urnresults}A). Vice versa, subjects who had previously experienced informative likelihoods reacted more strongly towards the likelihoods than subjects who had experienced informative priors (interaction effect of $\text{condition}\times\alpha_L=-0.22$, $t=-5.31$, $p<.001$, Figure~\ref{fig:urnresults}B). Furthermore, when estimating individual regressions for both conditions, the reaction to the prior was stronger than the reaction to the likelihood in the informative prior condition ($\hat{\alpha}_P=0.88$ vs. $\hat{\alpha}_L=0.70$, $p<.001$), whereas the reverse was true for the informative likelihood condition ($\hat{\alpha}_P=0.78$ vs. $\hat{\alpha}_L=0.92$, $p<.001$).

\subsubsection{Modeling results}

We trained the Learned Inference Model to predict the posterior probability for each of the two urns, given the prior probability for each urn and the ratio of colored balls in each of the urns, and the color of the observed ball. We trained 40 different ``simulated subjects'', 20 in each condition, each of which observed exactly the data that a subject in their condition had seen, and then tested them on the same test blocks that human subjects went through. We applied the same regression to our Learned Inference Model's judgments that we applied to subject data. Our Learned Inference Model's judgments were significantly influenced by both the prior ($\alpha_P= 0.27$, $t=41.41$, $p<.001$) and the likelihood ($\alpha_L=0.69$, $t=104.98$, $p<.001$). Importantly, the simulated subjects in the informative prior condition reacted more strongly toward the prior (interaction effect $\text{condition}\times\alpha_P=0.60$, $t=64.83$, $p<.001$, Figure~\ref{fig:urnresults}C), whereas the simulated subjects in the informative likelihood condition reacted more strongly toward the likelihood (interaction effect of $\text{condition}\times\alpha_L=-0.41$, $t=-44.27$, $p<.001$, Figure~\ref{fig:urnresults}D). Estimating individual regressions for both conditions as before, the reaction to the prior was higher than the reaction to the likelihood in the informative prior condition ($\hat{\alpha}_P=0.80$ vs. $\hat{\alpha}_L=0.21$, $p<.001$), whereas the reverse was true for the informative likelihood condition ($\hat{\alpha}_P=0.29$ vs. $\hat{\alpha}_L=0.71$, $p<.001$). Our Learned Inference Model therefore reproduces the behavioral findings observed in our experiment.

\subsection{Manipulating the query distribution between vs. within subjects}

The study reported in the previous section demonstrates that the weight of an information source (prior or likelihood) is correlated with its diagnosticity. An additional implication of the Learned Inference Model is that people will only be sensitive to the prior and likelihood if these parameters vary across queries during training of the recognition model. If the parameters are relatively constant (even if very diagnostic), then the recognition model will learn to ``ignore'' them. More precisely, the recognition model learns to amortize a fixed belief about the priors when they are held constant, and therefore will be relatively insensitive to surprising changes in the prior. This implication is relevant to a line of argument articulated by \citet{koehler1996base}, that base rates are only ignored when they are manipulated between rather than within subjects.

Several lines of evidence support Koehler's argument. \citet{fischhoff1979subjective} found greater sensitivity to base rates using a within-subject design, and similar results have been reported by \citet{birnbaum1983bayesian} and \citet{schwarz1991ease}, though see \citet{dawes1993equating} for evidence that base rate neglect occurs even using within-subject designs. \citet{ajzen1977intuitive} pointed out an asymmetry in the experiments of \citet{kahneman1973psychology}, where individuating information was manipulated within subject and base rates were manipulated between subjects. He suggested that this may have focused subjects' attention on individuating information at the expense of base rates. Using a full between-subjects design, \citet{ajzen1977intuitive} found greater sensitivity to base rates, consistent with a reduction in the relative salience of individuating information compared to the mixed within/between-subject design.

For concreteness, we will consider this issue in the context of the well-known taxi cab problem, where subjects were asked to answer the following question:

\begin{quote}
{Two cab companies, the Blue and the Green, operate in a given city. Eighty-five percent of the cabs in the city are Blue; the remaining fifteen percent are Green. A cab was involved in a hit-and-run accident at night. A witness identified the cab as a Green cab.
The court tested the witness' ability to distinguish a Blue cab from a Green cab at night by presenting to him film sequences, half of which depicted Blue cabs, and half depicting Green cabs. He was able to make correct identification in 8 out of 10 tries. He made one error on each color of cab.
What do you think is the probability (expressed as a percentage) that the cab involved in this accident was Green?}
\end{quote} 

Note that the prior in this case is fairly diagnostic: it strongly favors Blue cabs. However, several studies of the taxi-cab and similar problems produced evidence for base rate neglect \citep{tversky1973availability, bar1980base,lyon1976dominance}. These studies manipulated the base rates in a between-subject design. In the taxi cab problem, this corresponds to telling one group of subjects that 85\% of the cabs are Blue and telling another that 85\% are Green. Therefore, while the prior information is diagnostic, as it appears to each subject, it never varies.

\begin{figure}
\centering
    \includegraphics[width=0.5\textwidth]{figures/FC_temp.pdf}
  \caption{\textbf{Base rate neglect within and between subjects}. The y-axis shows the reaction to the prior as measured in predictions from the Learned Inference Model, the x-axis shows the different conditions. Reaction to the prior here is measured by the difference between the responses given to test queries in which the base rate was $85\%$ and those in which the base rate was $15\%$. Thus, a greater difference indicates a stronger reaction to prior information. The model simulations of the within-subjects design show a stronger reaction to the base rates than the simulations of the between-subjects design (which shows no reaction to the base rate at all).
  Both of these conditions produce under-reaction to the base rate compared to the Bayes-optimal judgment.} 
  \label{fig:FC}
\end{figure}

As mentioned above, \citet{fischhoff1979subjective} found greater base rate sensitivity using a within-subject manipulation of base rates in the taxi cab problem. Each subject was given two different base rates for the cab problem. We simulate the condition in which the base rates were either 85\% or 15\%. The Learned Inference Model reproduces the key finding of greater sensitivity to base rates using a within-subject design (Figure \ref{fig:FC}). In fact, the model exhibits total neglect of base rates in the between-subjects design, consistent with previous findings reported by \citet{lyon1976dominance}, though not all experiments show such extreme results.\footnote{The assumption that these are the only queries ever seen by participants would result in no covariance between prior and posterior in the between-subject design (since the prior never varies). This would give total base-rate neglect. This is an extreme assumption we make for illustrative purposes. More realistically, observing these queries simply concentrates the query distribution in this space and reduces covariance between the prior and the posterior.} The Learned Inference Model naturally explains the difference between experimental designs as a consequence of the fact that limited capacity and biased query distributions cause the model to ignore sources of information that do not reliably covary with the posterior.

The differences in historical query distributions for each subject as determined by the experimental design also sheds light on discrepancies in the effects of diagnosticity on the extent of under-reaction. Studies that find that reactions to a source of information are stronger with increasing relative diagnosticity \citep{bar1980base, fischhoff1984diagnosticity, ofir1988pseudodiagnosticity} of that source of information, used between-subject designs. This is analogous to our study in which subjects ``attend'' more to a source that was more informative in the experienced query distribution, leading to a stronger reaction to that source in future queries. However, studies reported in \citet{benjamin18} find greater under-reaction with increasing diagnosticity (Figure \ref{fig:Benj}). We note that these studies predominantly used within-subject designs,\footnote{Two exceptions to this pattern are \citet{sasaki2007belief} and \citet{beach1970sample}.} in which the same subject has to make inferences across all levels of diagnosticity. This leads to a much broader query distribution, where no source has reliably higher diagnosticity. Imposing a limitation on the capacity of the approximation results in an inability to faithfully express this broad query distribution, and some neglect of the specific parameters \citep{massey2005detecting}. This produces degeneracies in the response that manifest as greater under-reaction to more diagnostic sources of information. Our model therefore is able to replicate these seemingly contradictory findings, by taking into account the experienced query distribution of each subject.

\subsection{Extension to a continuous domain}

In this section, we investigate the effect of informativeness in a continuous domain, re-analyzing a data set reported by \citet{gershman2017blessing}. Subjects ($N=117$) were recruited through Amazon Mechanical Turk to take part in an experiment in which they had to predict the pay-off of different slot machines. In total, they were shown 10 different slot machines and had to make 10 guesses per slot machine. Pay-offs varied between 0 and 100 and were noisy such that no slot machine gave the same pay-off every time. Subjects were assigned randomly to one of two groups in a between-subjects design. Each machine $k$ was associated with a Gaussian distribution $\mathcal{N}(m_k,s)$ over outputs $y_{kn}$ on each trial $n$. The variance $s$ was fixed to 25 and the mean was drawn from a normal distribution $\mathcal{N}(m_0, v)$, with $m_0$ set to 40 and the global variance $v$ manipulated between groups. One group, in the low dispersion condition, experienced a global variance of $v=36$. The other group, in the high dispersion condition, experienced a global variance of $v=144$.

\citet{gershman2017blessing} used this paradigm to show how manipulating the dispersion produced faster or slower acquisition of abstract knowledge; we focus on a different aspect of the data here: subjects updating behavior. Figure \ref{fig:slotmachine}A shows subjects' reaction to the incoming data, quantified as how much they update their predictions after observing a slot machine's output, plotted against the predicted update of a rational hierarchical model inferring the posterior mean payoffs for a machine.\footnote{This rational hierarchical model is assumed to know the true parameter values for $s$, $v$ and $m_0$. However, in this experiment, these parameters for the full data-generating process were not explicitly shown to participants. We therefore also carry out an analysis using a hierarchical Bayesian model that additionally also infers these parameter values. This leads to similar results; see Appendix \ref{app:LTI_HBM} for details.} Subjects' updates are positively correlated with the model's predicted updates for both the high dispersion ($r(99)=0.57$, $p<.001$) and the low dispersion condition ($r(116)=0.36$, $p<.001$). This is expected as the hierarchical model is assumed to be a good first approximation of human behavior in this task. However, subjects updated their beliefs much more in the high dispersion than in the low dispersion condition -- even for the same rational update ($t(214)=9.24$, $p<.001$, after accounting for differences in rational updates between the conditions). This means that they were affected more strongly by the \textit{same} incoming evidence in the high dispersion than in the low dispersion condition. As the higher dispersion group experienced a higher global variance, this also means that they experienced a less informative prior. Thus, the fact that they under-reacted to the prior when it is relatively less informative reproduces the effect observed in our urn experiment in a continuous domain.

% This is calculated by binning the trials by the magnitude of the rational update, and comparing the responses from the high and low dispersion conditions in each bin. However, subjects updated their beliefs much more in the high dispersion than in the low dispersion condition (t(214)=9.24, p<.001) ($t(215)=5.75$, $p<.001$)
% \idg{is this conditioned on having the same rational update? because even the rational updates in the high-dispersion condition will be higher on average. The comparison needs to be done within bins.}


\begin{figure}
\centering
  \subfloat[Data from humans]{% 
    \includegraphics[width=0.45\textwidth]{figures/samexp.pdf}}
    \hfill
  \subfloat[Simulation results]{% 
    \includegraphics[width=0.45\textwidth]{figures/samsim.pdf}} 
  \caption{\textbf{Inferential errors in a continuous domain}. (A) Reanalysis of data from the payoff prediction task collected by \citet{gershman2017blessing}. (B) Simulations of the Learned Inference Model. Each panel shows subjective updates from prior to posterior ($\Delta$Data) on the y-axis and the update of a rational (hierarchical) model ($\Delta$Rational) on the x-axis. Error bars represent the standard error of the mean. Gray lines represent $y=x$.} 
  \label{fig:slotmachine}
\end{figure}

To simulate these findings, we parametrized the outputs of the Learned Inference Model to return the mean and log standard deviation of a Gaussian posterior. The function approximator was a neural network with a single two-unit hidden layer and a tanh non-linearity, taking as input the last observation, the mean of the observations seen so far in that episode and the number of observations in that episode. We trained the model on the same generative process as was applied in the behavioral study. We then use the model's predicted mean as the response on every trial.

The results, shown in Figure \ref{fig:slotmachine}B, demonstrate that the model qualitatively matches the human data: a positive correlation between the hierarchical model's predictions and our Learned Inference Model's responses for both the low dispersion ($r(19)=0.82$, $p<.001$) and the high dispersion condition ($r(19)=0.82$, $p<.001$), but critically the update was stronger for the high dispersion condition than for the low dispersion condition ($t(38)=7.40$, $p<.001$).

A discrepancy in the behavior of our model and the human data can be seen for large updates, where the model predictions flatten out significantly compared to human data. This is due to the degeneracy caused by limited capacity (see also figures \ref{fig:Benj} and \ref{fig:Benj_control}). Different architectures and ways to parametrize the approximate distribution $Q$ would lead to different kinds of degeneracies and might better model this aspect of the human data. Nonetheless, the effect we are primarily interested in in this study is that the updates in the high dispersion condition are greater than in the low dispersion condition (for both our model and the human data), for every value of the true Bayesian update. This validates our claim that reaction to data depends on the relative informativeness of the prior and the likelihood in past queries. This claim applies to both discrete and continuous domains.

\section{Further evidence for amortization: belief bias and memory effects}

We now shift from our analysis of under-reaction to a broader evaluation of the Learned Inference Model, focusing on two predictions. First, the model predicts that the accuracy of human probabilistic judgment will depend not only on the ``syntax'' of the inference engine (how accurately the inference engine manipulates probabilistic information) but also on the ``semantics'' (how well the probabilistic information corresponds to prior experience and knowledge). The semantic dependence gives rise to a form of \emph{belief bias}, in which people are more accurate when asked to make judgments about ``believable'' probabilistic information compared to ``unbelievable'' information, even when the syntactic demands (i.e., Bayes' rule) are equated. Second, the model predicts that there will be \emph{memory effects} (sequential dependencies): one probabilistic judgment may influence a subsequent judgment even when the two queries are different. 

\subsection{Belief bias}

In studies of deductive reasoning, people appear to be influenced by their prior beliefs in ways that sometimes conflict with logical validity. Specifically, they tend to endorse arguments whose conclusions are believable, and reject arguments whose conclusions are unbelievable, regardless of the arguments' logical validity \citep[e.g.,][]{evans1983conflict,newstead1992source,oakhill1989believability,janis1943relationship}. This belief bias phenomenon has played a pivotal role in adjudicating between theories of logical reasoning.

Belief bias has also been observed in probabilistic reasoning tasks \citep{evans2002background,cohen2017beliefs}. Here we focus on the study reported by \citet{cohen2017beliefs}, which varied whether the posterior probabilities dictated by Bayes' rule were close to independently measured intuitive estimates of the corresponding real-world probabilities. Subjects were asked to perform Bayesian reasoning in real-world situations (e.g., medical diagnosis), with prior and likelihood information that was either consistent with (believable condition), or inconsistent with (unbelievable condition) observed real-world values. The authors found that subjects' responses correlated well with Bayesian posterior probabilities in the believable condition (Figure \ref{fig:cohen}A), and were much less correlated in the unbelievable condition (Figure \ref{fig:cohen}B).

An intuitive interpretation for these results is that people anchor to the experienced real-world values of the prior, likelihood, and resulting posterior, and adjust their computations inadequately to the parameters actually presented in the query. The final responses are therefore closer to the true posterior when this anchor is close to the experimental parameters presented, as in the believable condition. Anchoring has previously been modeled as the outcome of a resource-limited sampling algorithms \citep{dasgupta2017hypotheses, lieder2017anchoring}, but has usually been studied in cases where the anchor is explicitly provided in the experimental prompt. Learned inference strategies account for memory of previous queries, and provide a model for what such an anchor for a new query could be, in the form of an \emph{a priori} guess based on relevant past judgment experience. This interpretation of learned inference as augmenting or anchoring other run-time approximate inference strategies is discussed in greater detail in the section on Amortization as Regularization.

\begin{figure}
\centering
  \includegraphics[width=0.95\textwidth]{figures/cohenetal.pdf}
  \caption{\textbf{Belief bias}. Top: experimental data. Bottom: simulations of the Learned Inference Model. (A) Empirical results for the believable condition \citep{cohen2017beliefs}. (B) Empirical results for the unbelievable condition. (C) Simulated results for the believable condition. (D) Simulated results for the unbelievable condition. The correlation between the actual and estimated posterior is closer to 1 (i.e., exact Bayesian inference) in the believable condition than in the unbelievable condition. The Learned Inference Model reproduces this effect.
  }
  \label{fig:cohen}
\end{figure}

We model these effects by training the Learned Inference Model on a set of priors and likelihoods that result in a particular posterior distribution, $P_A$, and testing on a set of priors and likelihoods that result in posterior probabilities that either have the same distribution $P_A$ (believable condition) or a different distribution $P_B$ (unbelievable condition)\footnote{Each simulated subject received a training distribution where the posterior probabilities were distributed according to the mixture distribution $P_A = 0.5 \times Beta(3, 1) + 0.5 \times Beta(1, 1)$. Simulated subjects in the believable condition were tested on posteriors sampled from the same distribution, those in the unbelievable condition were tests on posteriors sampled from the mixture distribution $P_B = 0.5 \times Beta(1, 3) + 0.5 \times Beta(1, 1)$. An equal number of simulated subjects received $P_B$ as the training distribution (with $P_A$ as the test distribution in the unbelievable condition).}. The model produces responses that are highly correlated with the true posterior probability in the believable condition (Figure \ref{fig:cohen}C, $r=0.78$, $p<.001$), but this correlation is much lower in the unbelievable condition (Figure \ref{fig:cohen}D, $r=0.14$, $p=.06$, comparative test: $z=2.64$, $p=.004$). Our model therefore reproduces the belief bias effect reported by \citet{cohen2017beliefs}.

\subsection{Memory effects}

In our own previous work \citep{dasgupta2018remembrance}, we observed signatures of amortized inference in subjects' probability estimates. One such signature was that their answers to a question (Q2) were predictably biased by their answers to a previous question (Q1). This bias was stronger in cases were the two queries were more similar.

The experiments were carried out in the domain of scene statistics. We asked people to predict the probability of the presence of a ``query object'', given the presence of a ``cue object'' in a scene. The query object was kept the same across both queries. In one condition, the cue object in Q1 was ``similar'' to the one in Q2, measured by the KL divergence between the two posteriors over objects conditional on the cue object. In the other condition, the cue object in Q2 was dissimilar from the one in Q1.

For example: \\
Q1: ``Given the presence of a chair in a photo, what is the probability of there also being a painting, plant, printer, or any other object starting with a P in that photo?''\\
Q2 (Similar): ``Given the presence of a book in a photo, what is the probability there is any object starting with a P in the photo?''\\
Q2 (Dissimilar): ``Given the presence of a road in a photo, what is the probability there is any object starting with a P in the photo?''\\

We biased the responses to Q1 for half the subjects using an unpacking manipulation, which produces subadditivity of probability judgments. A subadditivity effect occurs when the perceived probability of a hypothesis is higher when the hypothesis is `unpacked' into a disjunction of multiple typical sub-hypotheses \citep{fox1998belief,tversky1994support,dasgupta2017hypotheses}. Using an example from our own work, when subjects were told that there was a ``chair'' in the scene, they tended to assign higher probability to the `unpacked' hypothesis ``painting, plant, printer, or any other object starting with a P'', than a control group who was asked about the `packed' hypothesis ``any object starting with a P''. The true posterior is the same across these different conditions. Critically, we found that the subadditivity group assigned higher probability to the hypothesis queried in Q2 than the control group, holding fixed Q2 across groups. This means that the bias induced by Q1 was detectable in Q2, indicating that some computations involved in answering Q1 were re-used to answer Q2. Importantly, we found that this bias was only detectable if the cue objects across Q1 and Q2 were similar (Figure \ref{fig:amo}A). 
For example, first being asked Q1 about the probability of the set of ``objects starting with a P'' in the presence of a ``book'', and afterwards being asked Q2 about the probability of ``objects starting with a P'' in the presence of a ``chair'' produced a memory effect whereas asking the same Q2 did not show this memory effect when subjects in Q1 were asked about the probability of the set of ``objects starting with a P'' in the presence of a ``road''. We argued that this was a sign of intelligent reuse of computation, since a chair is more likely to co-occur in scenes with a book than in scenes with a road.

\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{figures/amonew.pdf} 
  \caption{\textbf{Memory effect}. (A) Observed subadditivity effect in query 2 reported in \citet{dasgupta2018remembrance}. Cues that were similar to a previous query showed a higher effect than cues that were less similar, indicating strategic reuse of past computation. (B) Simulated subadditivity effect. Provided that the model was trained to exhibit a subadditivity effect in a first query, this effect remained stronger for similar queries than for dissimilar queries. Error bars represent the standard error of the mean.
  } 
  \label{fig:amo}
\end{figure}

In \citet{dasgupta2018remembrance}, we modeled reuse using amortizations of samples in a Monte Carlo framework. However, a basic problem facing this framework is that the Monte Carlo sampler cannot ``know'' about similarity (measured in terms of KL divergence) without knowing the true posterior, which of course is the entity it is trying to approximate. The Learned Inference Model provides an answer to this conundrum, by adaptively amortizing (i.e., reusing) past computations without access to the KL divergence or other omniscient similarity measures.

In the interest of simplicity, we simulate these effects in a smaller version of the original environment, rather than using the full-scale scene statistics as in our original study \citep{dasgupta2018remembrance}. We simulated a data set of scene statistics with 12 objects with 2 different ``topics'' that drive the multinomial probability distributions over these 12 objects \citep{blei2003latent}. Using this setup, one can derive the joint probability of any 2 objects. The joint probability is all that is required for blackbox variational inference \citep{ranganath2014black}, so we are able to train a larger version of the Learned Inference Model (with 1 hidden layer, 10 hidden units and a radial basis function non-linearity), which takes as input each object $d$ (a 12-dimensional one-hot vector) and outputs the 12-dimensional multinomial probability distribution $P(h|d)$ over all objects.

We then manipulated $P(h_i,d)$ for a specific cue object $d$ and query object $h_i$ by biasing it to be higher than its true value (analogous to the subadditivity manipulation) and trained the Learned Inference Model with the biased joint distribution for a few steps. This caused the model to partially amortize Q1, which in turn influenced its answer to Q2 (a memory-based subadditivity effect), since the same network was used to answer both. Our simulations demonstrate that the subadditive effect is significantly larger for similar compared to dissimilar cue objects (Figure \ref{fig:amo}B; $t(58)=4.62$, $p<.001$). Our model therefore reproduces the difference in the memory effect reported by \citet{dasgupta2018remembrance}. Note however that the simulations are carried out in a different generative model (i.e., a simplified version of the empirical environment), and the sizes of the effects are not directly comparable.

Note that we did not attempt in this section to more directly model subadditivity, as this would require the introduction of additional mechanisms into our framework. Prior work by \citet{dasgupta2017hypotheses} suggests how Monte Carlo sampling naturally explains subadditivity. As we address further in the General Discussion, there are a number of ways that the Monte Carlo and amortized variational inference frameworks could be integrated.

\section{Amortization as Regularization}

We introduced amortization as a method for optimizing a function that maps queries to posterior distributions. Another view of amortization is as a method for regularizing an estimator of the posterior distribution for a single query. The intuition behind this is that one might have gained over experience some knowledge of what the relevant task parameters and the resulting posteriors generally are, and use that to regularize a noisy estimator for the posterior for a new query at run-time. At first glance, it may seem odd to think about the variational optimization procedure as producing an estimator in the statistical sense, since the posterior is a deterministic function of the query. To explain why this is in fact not odd, we need to lay some groundwork.

An inference engine that is not bound by time, space or computational constraints will reliably output the true posterior distribution, whereas a constrained inference engine will output an approximate posterior. There is no way for the constrained inference engine to know exactly how close its approximation is to the true posterior. Another way of saying this is that the constrained inference engine has \emph{epistemic uncertainty}, even if the engine itself is completely deterministic and hence lacks any \emph{aleatory uncertainty} (i.e., uncertainty arising from randomness).\footnote{Epistemic uncertainty due to computational imprecision has been studied systematically in the field of \emph{probabilistic numerics} \citep{hennig2015probabilistic}.} We can thus regard the approximate posterior as an estimator of the true posterior, and ask how we might improve it through the use of inductive biases: if we have some prior knowledge about which posteriors are more likely than others, we can use this knowledge to bias the estimator and thereby offset the effects of computational imprecision.

To formalize this idea in the context of amortized inference, the optimization problem in Eq. \ref{eq:amort} can be rewritten (up to an irrelevant constant factor) as follows:
\begin{align}
\phi^\ast = \argmin_{\phi \in \Phi} \left[
\mathcal{D}[Q_\phi(h|d)||P(h|d)] + \frac{1}{P_\text{query}(d)} \mathbb{E}_{P_\text{query}} \left\{ \mathcal{D}[Q_\phi(h|d')||P(h|d')] | d' \neq d \right \} \right].
\end{align}
This expression separates a ``focal'' query $d$ (the one you are trying to answer now) from the distribution of other queries ($d' \neq d$). If the focal query is high probability, the second term counts less, and in the limit disappears, such that the optimization problem reduces to fitting the variational parameters to the focal query. When the focal query is low probability, the second term exerts a stronger influence, and in the limit the optimization problem completely ignores the focal query. We can think of the second term as a regularizer: it pulls the variational parameters towards values that work well (minimize divergence) under the query distribution, and this pull is stronger when the focal query is low probability.

The regularization perspective allows us to connect our framework to the ``correction prior'' theory developed by \citet{zhu_sanborn_chater_2018}. According to Zhu and colleagues, the brain approximates the posterior by generating stochastic hypothesis samples, and then ``corrects'' this approximation by regularizing it towards a meta-Bayesian prior over posteriors \citep[see also][]{rasmussen2003baysian}. The theoretical motivation for correction is that the posterior approximation is a random variable due to the stochastic sampling process; when only a few samples are drawn \citep[cf.][]{vul2014one,dasgupta2017hypotheses} this produces a noisy estimate of the posterior that may deviate significantly from the true posterior. The correction procedure reduces variance in the posterior estimate by increasing bias, pulling it towards the meta-Bayesian prior over posteriors (intuitively, towards an `a priori' guess based on past experience), and therefore partially compensates for the error in the sampling process.

More formally, the stochastic hypothesis sampling procedure corresponds to a form of Monte Carlo approximation (see Eq. \ref{eq:montecarlo}). In the simple binary setting, $\mathcal{H} = \{0,1\}$, the Monte Carlo inference engine generates $M$ samples from $P(h|d)$\footnote{We assume for simplicity that the inference engine can directly sample from the posterior, though in most cases of practical interest the inference engine will sample from a proxy distribution. For example, in Markov chain Monte Carlo schemes, the inference engine samples from a Markov chain whose stationary distribution is the posterior \citep{dasgupta2017hypotheses,gershman2012multistability}.}. In our generic formalism, the approximate posterior is parametrized by the proportion of ``successes'' $\phi = K/M$, where $K = \sum_{m} \mathbb{I}[h^m=1]$. The approximate posterior is then given by $Q_\phi(h|d) = \phi^h (1-\phi)^{1-h}$. This approximation will exhibit large stochastic deviations from the true posterior for small $M$.\footnote{The variance of the Monte Carlo estimator for a binomial distribution with success probability $p$ is $p(1-p)/M^2$. \label{binom}}

To reduce the variance of the Monte Carlo estimator, \citet{zhu_sanborn_chater_2018} proposed a meta-Bayesian inference procedure that computes the posterior over the optimal parameters $\phi^\ast$ given the ``data'' supplied by the random variable $\phi$:
\begin{align}
    P(\phi^\ast|\phi) \propto P(\phi|\phi^\ast) P(\phi^\ast).
\end{align}
When the prior $P(\phi^\ast)$ is a Beta(A,B) distribution, the posterior mean estimator is given by:
\begin{align}
    \mathbb{E}\{ \phi^\ast|\phi \} = w \phi + (1-w) \frac{A}{A + B},
\end{align}
where $w = \frac{1}{M + A +B}$ controls the balance between the Monte Carlo estimate $\phi$ and the prior mean $\frac{A}{A+B}$, which acts as a regularizer. Intuitively, a larger sample size ($M$) or weaker prior ($A+B$) shift the balance from the prior to the Monte Carlo estimate. When $A=B$, as assumed in \citet{zhu_sanborn_chater_2018}, the prior mean is $1/2$. This gives rise to a form of ``conservatism'' in which probabilities greater than $1/2$ are underestimated, and probabilities less than $1/2$ are overestimated \citep{erev1994simultaneous,hilbert12}. We remind the reader that this form of conservatism is distinct from the under-reaction that we modeled in previous sections, which is sometimes referred to as conservative probability updating \citep{edwards1968conservatism}.

\citet{zhu_sanborn_chater_2018} found evidence for such a ``conservative'' prior using two different data sets. The first one was data collected by \citet{costello2018surprising}, who asked subjects to estimate probabilities for a range of weather events (e.g., cold, windy or sunny), or to estimate probabilities of future events (e.g., ``Germany is in the finals of the next World Cup.''). The second one was data collected by \citet{stewart2006decision}, who assessed the variability of probability estimates for different phrases such as ``improbably'' or ``quite likely''. The sampling and correction prior model was able to quantitatively capture the observed conservatism effect: people weighted their probability estimates towards 0.5 when providing their judgments (Figure~\ref{fig:CP}A). It also led to a novel prediction that the variance of probability estimates should be a quadratic function of the true probability, with a peak at $1/2$. %(see Footnote \ref{binom}). 
This prediction was confirmed in the experimental data (Figure~\ref{fig:CP}B).

\begin{figure}
\centering
    \includegraphics[width=0.98\textwidth]{figures/correctionprior2.pdf}
  \caption{\textbf{Correction prior.} (A) Simulation results from the correction prior model in \citet{zhu_sanborn_chater_2018} exhibiting conservatism. Black line represents the optimal response and the colored lines show estimates from different parameterizations of the model. (B) Quadratic relation between the variance of subjective probability estimates and mean subjective probability estimates, as observed by \citet{zhu_sanborn_chater_2018}. Points show data points from previous empirical studies. The line shows best fit quadratic fit to this data. (C) The Learned Inference Model replicates the conservatism effect. Points represent mean estimates from our model, the pink line represents the best fit linear regression to these points, the black line represents the optimal response. (D) The Learned Inference Model replicates the variance effect. Points represent variance of the subjective responses from our model for different mean subjective responses. The pink line represents the best fit quadratic fit to these points.} 
  \label{fig:CP}
\end{figure}

We now show that we can capture the same behavioral phenomena (mean and variance effects) using the Learned Inference Model. This analysis provides an important insight: the random nature of the approximate posterior is not necessary (as in the correction prior framework), and that regularization, which can act even on deterministic approximations (provided these approximations are capacity limited as in the Learned Inference Model), can explain the observed effects.

To simulate the experimental data, we created a query distribution that would give rise to posteriors distributed according to Beta$(0.27,0.27)$, which Zhu and colleagues obtained by fitting their correction prior to data on probability judgments collected by \citet{stewart2006decision}. We then trained the Learned Inference Model on queries sampled from this distribution. When tested on a range of queries, the trained model replicated the conservatism effect in Figure~\ref{fig:CP}C. Regressing the expected probabilities onto the models' responses revealed an estimated slope of $0.54$, which was significantly smaller than 1 (Wald test: $t=14.49$, $p<.001$). This arises from regularization towards the mean response of $0.5$. \citet{zhu_sanborn_chater_2018} explained the quadratic relationship between the expectation and the variance as a feature of the sampling approximation. However, our results demonstrate that the effect can arise even when the approximation is deterministic, as long as it is capacity limited. The key observation is that the Learned Inference model contains degeneracies in the mapping from true to approximate posterior and these degeneracies are more apparent further from the mean. This increase in degeneracy results in lower variance at extreme probabilities. This can also be interpreted as a bias-variance trade-off \citep{geman1992neural} -- the increased bias towards the mean response (conservatism) at extreme probabilities causes the variance of the estimator to decrease.

Regressing the models predictions onto the simulated variance, we find that a quadratic model performs better than an intercept-only model as also reported by \citet{zhu_sanborn_chater_2018}, $F(1,19)=78.73$, $p<.001$ (Figure~\ref{fig:CP}D). Solving the resulting quadratic regression for its maximum showed that this function peaked at 0.498 (i.e., close to 0.5 as predicted by the correction prior). We conclude that our Learned Inference Model can reproduce the conservatism and quadratic variance effects reported by \citet{zhu_sanborn_chater_2018}, but without a stochastic sampling algorithm. In the General Discussion, we return to the relationship between learning to infer and stochastic sampling.

\section{General Discussion}

Although many studies suggest that the human brain is remarkably adept at carrying out Bayesian inference \citep[e.g.,][]{griffiths2006optimal,kording2006bayesian,knill1996perception,oaksford2007bayesian}, many other studies present evidence for systematic departures from Bayesian inference \citep[e.g.,][]{griffin1992weighing,benjamin18,kahneman1972subjective,kahneman1973psychology,grether1980bayes}. What does this mean for theories of probabilistic reasoning? Should we abandon Bayesian inference as a descriptive model? Are people using Bayesian inference in some situations and heuristics in others? These questions motivated our effort to formulate a new theory---\emph{learning to infer}.

The starting point of our new theory is the assumption that the brain must efficiently use its limited computational resources \citep{gershman2015computational,lieder2019resource}. This assumption means that Bayes-optimality is \emph{not} the appropriate normative standard for probabilistic reasoning. Rather, we must consider how accuracy of probabilistic reasoning trades off against the computational cost of accuracy. A learning system that is trained to approximate probabilistic inference will, when a limit on the computational cost is imposed  (modeled here as a computational bottleneck), exploit regularities in the distribution of queries. These regularities allow the system to efficiently use its limited resources, but it will also produce systematic errors when answering queries that are low probability under the query distribution. We showed that these are precisely the errors made by people.

We implemented a specific version of this theory (the \emph{Learned Inference Model}) using a neural network function approximator, where the computational bottleneck corresponds to the number of nodes in the hidden layer. Our choice of neural network function approximator was motivated by a natural complementarity between the strengths of probabilistic generative models and neural networks. Neural networks are best thought of as pattern recognition and function approximation tools, rather than as ways to represent causal knowledge about the world \citep{lake2017building}. In contrast, probabilistic generative models are good ways to represent knowledge about causal structure, and define what problem we are trying to solve in inferring hidden causes from data, but they do not specify good effective inference algorithms. By using neural networks to learn to infer in a probabilistic generative model, a cognitive agent can combine the strengths of these two approaches. Neural networks are used not to recognize patterns in the external world, but patterns in the agent's own internal computations: what kinds of observed data typically indicate that a particular inference is appropriate?

The model reproduced the results of several classical and recent experiments in which people under-react to probabilistic information. We first observed patterns in under-reaction predicted by limited capacity. We then found that the model can reproduce sample size effects, in particular different reactions to the strength and weight of evidence, by more strongly reacting to sources of information that have historically been more diagnostic of the posterior. This led to the new predictions that under-reaction to the evidence should occur when the queried posteriors covary more strongly with the prior than with the likelihood (causing the function approximator to ``attend'' to more to the prior), whereas under-reaction to the prior should occur when the queries covary more with the likelihood than the prior. We tested this prediction in a new experiment that varied the structure of the query distribution, confirming that people make different inferential errors depending on the query distribution, even when all probabilistic information is provided to them. We also applied the analysis of under-reaction to several other experimental factors, such as sample size, between- vs. within-subject designs, and continuous hypothesis spaces.

The Learned Inference Model also provided insights into a range of other inferential errors. For example, we showed how it could explain belief bias in probabilistic reasoning, the finding that people are closer to the Bayesian norm when given probabilities that are consistent with their real-world knowledge \citep{cohen2017beliefs}. Belief bias arises, according to the model, because the function approximator has to make predictions about the posterior in a region of the query space that it was not trained on. Another example is the finding of sequential effects in probabilistic reasoning: a single query can bias a subsequent query, if the two posterior distributions are sufficiently similar \citep{dasgupta2018remembrance}. This arises, according to the model, because learning in response to the first query alters the function approximator's parameters, thereby biasing the output for the second query.

Finally, we showed how the Learned Inference Model offers a new realization for the correction prior proposed by \citet{zhu_sanborn_chater_2018}, according to which inferences are regularized towards frequently occurring posterior probabilities. Taken together, these results enrich our understanding of how people perform approximate inferences in computationally challenging tasks, which we can be accomplished by learning a mapping between the observed data and the posterior. Our proposed Learned Inference Model is a powerful model of human inference that puts learning and memory at the core of probabilistic reasoning.

\subsection{Related Work}

Egon Brunswik famously urged psychologists to focus on the structure of natural environments, and the corresponding structure of features that the mind relies on to perform inferences \citep{brunswik1955representative}. Herbert Simon proposed the metaphor of the mind's computations and the environment's structure fitting together like the blades of a pair of scissors, such that psychologists would have to look at both blades to understand how the scissors cut \citep{simon1955behavioral}. This interdependence between people's strategies and their environments has been stressed by psychologists for decades \citep{todd2007environments}, and our proposed Learned Inference Model fits well into that tradition. Essentially, what we have argued for here is that subjects do not rely on a stable and fully rational engine for probabilistic inference, but rather that they learn to infer---i.e., they optimize a computationally bounded approximate inference engine, using memory to learn from previous relevant experience. Our proposal emphasizes the importance of studying an agent's environment, in particular the query distribution they are exposed to. For example, whereas subjects who experienced informative priors in our urn experiment ended up showing conservatism, subjects who experienced informative likelihoods showed base rate neglect. Our proposal also stresses the importance of both memory (people re-use past computations) and structure learning (people learn a mapping between observable and the posterior) to explain subjects' probabilistic reasoning more generally.

The idea that memory plays an important role in inference has been studied by a number of authors. For example, \citet{thomas2008diagnostic} developed a theory of hypothesis generation based on memory mechanisms \citep[see][for an overview of this research program]{thomas2014memory}. Related ideas have also been explored in behavioral economics to explain decision making anomalies \citep{bordalo2017memory}. Our contribution has been to formalize these ideas within a computational rationality framework \citep{gershman2015computational}, demonstrating how a resource-limited system could adaptively acquire inferential expertise, which would in turn produce predictable inferential errors.

Ours is not the first proposal to apply a neural network-based approach to explain how people reason about probabilities. \citet{gluck1988conditioning} used an adaptive network model of associative learning to model how people learned to categorize hypothetical patients with particular symptom patterns as having specific diseases. Their results showed that when one disease was far more likely than another, the network model predicted base rate neglect, which they confirmed in subjects across 3 different experiments. This is similar to our prediction that the Learned Inference Model will start ignoring the prior if it has been historically less informative, for example because one disease has never appeared during learning. Using a similar paradigm, \citet{shanks1991connectionist} showed that some versions of base rate neglect can be accounted for by a simple connectionist model. Both of these studies, however, provided subjects with direct category feedback, whereas our Learned Inference Model only requires access to the joint probabilities, making it more algorithmically plausible. \citet{bhatia2017associative} showed how vector space semantic models were able to predict a number of biases in human judgments, including a form of base rate neglect based on typical and non-typical descriptions of people and judgments about their occupations.

That the prior and the likelihood can be differentially weighted based on their importance has been proposed before. For example, \citet{koehler1996base} argued that neither the base rate nor the likelihood are ever fully ignored, but may be integrated into the final judgment differently, such that whether they are predictive of the eventual outcome would influence the weight people place on them. The idea that people ignore aspects of probability descriptions if they are not informative is a pivotal part of ecological definitions of rationality, for example as part of the priority heuristic \citep{brandstatter2006priority}. In one exemplary demonstration of how ignoring unpredictive information can be beneficial, \citet{todd2002testing} simulated environments in which base rates changed more frequently than cue accuracies, and found that models ignoring either the base rate or the likelihood could perform as well as their fully Bayesian counterparts.

\subsection{Integrating with sampling-based approaches}
\ref{sec:LTI_sampl_integ}

Our theory relies heavily on a variational framework for thinking about the optimization problem that is being solved by the brain's approximate inference engine. This creates some dissonance with prevailing ideas about approximate inference in cognitive science, most of which have been grounded in a hypothesis sampling (Monte Carlo) framework \citep[see][for a review]{sanborn2016bayesian}, with small numbers of samples. Hypothesis sampling has also been studied independently in neuroscience as a biologically plausible mechanism for approximate inference \citep[e.g.,][]{buesing2011neural,haefner2016perceptual}. In our own prior theoretical work, we have employed hypothesis sampling to explain a range of inferential errors \citep{dasgupta2017hypotheses,dasgupta2018remembrance}. The question then arises of how (if at all) we can reconcile these two perspectives -- one of a variational approximation learned over several past experiences, versus the other of a Monte Carlo approximation consisting of a handful of samples in response to the current query. We discussed in broader terms the potential role of a learned inference model in augmenting predictions from a noisy sampler as part of our section on `Amortization as Regularization'. We had discussed this in broader terms in CHapter \ref{chap:approx}. Here we sketch a few more concrete possibilities for how these approaches might be combined to build new, testable models of human probabilistic inference.

Almost all practical Monte Carlo methods rely on a proxy distribution for generating samples. Markov chain Monte Carlo methods construct a Markov chain whose stationary distribution is the true posterior, often making use of a proposal distribution to generate samples that are accepted or rejected. Importance sampling methods simultaneously draw a set of samples from a proposal distribution and reweight them. Particle filtering methods apply the same idea to the case where data are observed sequentially. One natural way to combine variational inference with these methods is to use the variational approximation as a proposal distribution. This idea has been developed in the machine learning literature \citep[e.g.,][]{de2001variational,gu2015neural}, but has not been applied to human judgment.

For Markov chain Monte Carlo methods, another possibility would be for the variational approximation to supply the initialization of the chain. If enough samples are generated, the initialization should not matter, but a number of cognitive phenomena are consistent with the idea that only a small number of samples are generated, thereby producing sensitivity to the initialization. For example, probability judgments are influenced by different ways of unpacking the sub-hypotheses of a disjunctive query \citep{dasgupta2017hypotheses} or providing incidental information that serves as an ``anchor'' \citep{lieder2017anchoring,lieder2018empirical}. In these studies, the anchor is usually provided as an explicit prompt in the experiment -- learned inference strategies provide a model for what such an anchor for a new query could be in the absence of an explicit prompt, in the form of an `a priori' guess based on past judgment experience.

Several recent methods in the machine literature combine the complementary advantages of sampling approximations and variational approximations leading to several new algorithms \citep{li2017approximate, naesseth2017variational, ruiz2019contrast} that could also be studied as models for human judgment.

The blackbox variational inference algorithm that we use (see Chapter \ref{chap:approx}) does in fact involve sampling: the gradient of the evidence lower bound is approximated using a set of samples from the variational approximation. Although we are not aware of direct evidence for such an algorithm in brain or behavior, the idea that hypothesis sampling is involved in the learning process is an intriguing possibility that has begun to be studied more systematically \citep{bramley2017formalizing,bramley2018grounding,rule2018learning}. It resonates with work in other domains like reinforcement learning, where people seem to engage in offline simulation to drive value updating \citep{gershman2014retrospective,gershman2017imaginative,momennejad2018offline}.

\subsection{Connections to other models for judgment errors}

In addition to the sampling-based approaches that we discuss in the previous subsection, there may also be other sources of probabilistic judgment errors in humans. Some of these include misinterpretation or misunderstanding of the question being posed by the experimenter \citep{villejoubert2002inverse}, inability to map the provided probabilities onto an intuitive causal model \citep{krynski2007role}, or simply disbelief in the experimenter's description of the data-generating process.\footnote{While these models predict deviations from optimality, they do not always specify a model for the responses actually produced, when participants do not understand, internalize, or believe the data-generating process presented by the experimenter. One possibility is that they fall back upon `a priori' notions of the data-generating process. Our Learned Inference Model provides a model for what these context-sensitive `a priori' beliefs might be -- in particular how these could be learned from past judgment experience.} We have restricted most of our attention to studies in which subjects had to reason about data-generating processes that are explicitly described (e.g., how many balls of each color were present in an urn). Considerable evidence suggests that people's judgments and decisions differ depending on whether they have received a problem as a description or have experienced probabilities through experience \citep{hertwig2009description,hertwig2018experience}. These are all likely part of the explanation for the judgment errors discussed in this paper. Below, we suggest a few ways in which predictions from our model could be integrated with, or distinguished from, predictions driven by these other mechanisms. 
 
The Learned Inference Model in its current formulation assumes that the correct data-generating process is provided in the query, and only learns how to do inference within this data-generating process. It does not account for uncertainty about or disbelief in the data-generating process itself, and is insensitive to whether information about it is acquired through description or learned from previous experience. One could manipulate the amount of experience participants have with the data-generating process by letting them observe samples from it within the experiment, rather than only providing them with a description of the probabilities. This would manipulate the certainty participants have in the data-generating process, and pave the way towards assessing its influence on probability judgments in these domains -- independent of the effects predicted by a Learned Inference Model which assumes perfect knowledge of the data-generating process.

Domain knowledge and pre-experimental experience can also contribute to uncertainty about the presented data-generating process. Most of our results are from highly controlled domains (i.e., balls in urns), that people likely do not have strong intuitions for based on past experience. Our findings in these domains are modeled with inference strategies learned within the experiment. Considerable evidence shows that people's judgments and decisions are influenced by whether the data-generating process presented matches pre-experimental intuitions about the causal structure of the real world \citep{krynski2007role, ajzen1977intuitive}. The Learned Inference Model in its current formulation has no notion of real-world causal structure, and therefore no intuition about it. It can learn inference strategies from within-experiment experience in any data-generating process irrespective of whether it respects such intuitions. Expanding our results to naturalistic settings, where people might have `a priori' causal intuitions from previous experience, would allow us to manipulate how `intuitive' the presented data-generating process is and tease apart its role in judgment errors from the predictions of the Learned Inference Model.

Finally, we discussed in the previous section how learned inference strategies might be integrated with memoryless sampling-based approaches that approximate responses at each query independently with a small number of samples. We discussed this as a bias-variance trade-off in our section on `Amortization as regularization'. A prediction of this framework is that the extent of such regularization will depend on the amount of experience accrued in that domain, with more experience favoring a learned inference strategy over memoryless stochastic sampling. Empirical results suggest that experts and novices employ different decision strategies, with experts appearing to rely more on memory-based heuristics \citep{gigerenzer2011heuristic, dhami2001bailing, reyna2006physician}. Studying judgment errors across domains where participants vary in pre-experimental experience, or even over the course of an experiment as within-experiment experience increases, would allow us to better understand how learned and memoryless inference strategies interact and trade-off. 

% Memory-less approaches are flexible and unbiased, but this comes with the cost of being more resource intensive at run-time than the more rigid learned inference strategies we discuss here, since they do not re-use previously completed computations. Empirical results for probability judgments under cognitive load or time pressure have been modeled as fewer samples being drawn in sample-based inference models \citep{dasgupta2017hypotheses, lieder2018empirical}. Manipulating cognitive resources available at run-time in this way could also provide a lens into how expensive memory-less and cheap learned strategies trade-off in human probabilistic inference.

More broadly, our theory of learning to infer allows us to frame many of these errors in the context of resource-rationality \citep{lieder2019resource,gershman2015computational}, and explains how biases observed in the lab could be inevitable consequences of algorithms that let resource-bounded minds solve hard problems in real time. Many of the alternative mechanisms for judgment errors suggested above have also been interpreted this way \citep{lieder2018overrepresentation, lieder2017anchoring, parpart2018heuristics}. Our model uniquely addresses how such biases could derive rationally from limited capacity inference strategies learned from the history of past judgment experience. We leave many questions open for further investigation, for example: how the mechanisms of learning to infer interact with other approximate inference strategies; which of these phenomena are best explained by our approach as opposed to others, and under what circumstances; and how previously proposed accounts in part might also be consequences of learned inference strategies.

\subsection{Limitations and future directions}

We modeled the mapping between queries and the posterior using a multilayer neural network. This model does not assume any explicit representational structure; the mapping is optimized using blackbox variational inference, and many different mappings can be learned depending on the capacity of the neural network. While this model provides a good first-order approximation of what the brain might be doing, it remains to be seen whether the functional form we chose is the best relative to other possibilities. For example, our recent work on function learning suggests that people have a strong inductive bias for compositional functions---i.e., functions that can be built up out of simpler building blocks through algebraic operations \citep{schulz2017compositional}.

Another limitation of our work is that we focused on cases where the posterior is defined over a single random variable, but in the real world people frequently need to make inferences about subsets of variables (or functions of those subsets) drawn from very large sets of variables with complex joint distributions. This complexity was the motivation for our previous work on hypothesis sampling, which offers a computationally tractable solution to this problem \citep{dasgupta2017hypotheses}. The memory-based subadditivity effects that we modeled \citep{dasgupta2018remembrance} are an example of a phenomenon in which amortized inference and hypothesis sampling might be unified, but we have not provided a comprehensive unification (though the previous section describes some potential avenues). For example, although our model can capture the fact that more similar query items can lead to higher subadditivity effects than less similar items, it currently does not explain how subadditivity arises to start with.

In our model, the inputs are already boiled down to only the relevant variables and therefore very low-dimensional, and the cost function only evaluates how well the network predicts posterior probabilities from these inputs. Inputs in the real world, however, are likely more noisy and high dimensional. Several related but different tasks are often multiplexed into the same network representations in the brain \citep{alon2017graph, feng2014multitasking}. Extending our theory to more noisy and uncertain real-world learning is an important and interesting challenge.

We have assumed that the computational bottleneck is fixed, defining a limited representational capacity for the function approximator that must be shared (possibly unequally) across queries. However, in particular when considering computational capacity as a cost, another possibility is that the bottleneck is flexible: representational capacity might increase (e.g., through the allocation of additional units) when greater accuracy becomes worth the cost of this greater investment, possibly by commandeering resources from other cognitive systems. This predicts that more accurate probabilistic judgment should be associated with poorer performance on other concurrent tasks that share cognitive resources, and that properly incentivizing people should improve their performance. Contrary to this, evidence suggests that incentives have little effect on some inferential errors, such as base rate neglect \citep{grether1980bayes,ganguly2000asset,phillips1966conservatism}, and this point is corroborated by evidence that inferential errors also appear in real markets with highly incentivized traders \citep{barberis1998model}.
% Our new proposal accounts distinctively well for the previously unexplained paradox of why some biases are observed in certain cases, while the opposite is observed in others. 

\subsection{Conclusion}

In his paper criticizing past research on base rate neglect, \citet{gigerenzer1996narrow} argued that ``adding up studies in which base rate neglect appears or disappears will lead us nowhere. Progress can be made only when we can design precise models that predict when base rates are used, when not, and why.'' Here, we have offered such a model. Concretely, our proposal is that people \emph{learn to infer} a posterior from observed information such as the priors, likelihoods and data. Our Learned Inference Model explains a host of effects on belief updating such as under-reaction, belief bias, and memory-dependent subadditivity. It also renders inference approximate and computationally tractable, making it a plausible process model of human probabilistic inference.


